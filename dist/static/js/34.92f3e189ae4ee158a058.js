webpackJsonp([34],{"8v8l":function(e,t){},eKKA:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Dd8w"),s=a.n(r),i=a("Xxa5"),n=a.n(i),l=a("exGp"),o=a.n(l),u=a("Mqi+"),c=a("jmyz"),m={name:"PrescriptionAdd",props:{prescriptionAddVisiable:{default:!1}},computed:{show:{get:function(){return this.prescriptionAddVisiable},set:function(){}}},data:function(){return{form:this.$form.createForm(this),loading:!1,selectedStandardPrescriptionName:"",stimulationSiteOptions:[],isTBSMode:!1}},mounted:function(){var e=this;return o()(n.a.mark(function t(){return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(u.b)(e);case 2:e.stimulationSiteOptions=t.sent,e.$nextTick(function(){e.setupFormWatchers()});case 4:case"end":return t.stop()}},t,e)}))()},methods:{reset:function(){this.loading=!1,this.form.resetFields(),this.selectedStandardPrescriptionName="",this.formWatcher&&(clearInterval(this.formWatcher),this.formWatcher=null)},onClose:function(){this.reset(),this.$emit("close")},beforeDestroy:function(){this.formWatcher&&(clearInterval(this.formWatcher),this.formWatcher=null)},handleSubmit:function(){var e=this;this.form.validateFields(function(t,a){if(!t){var r=s()({},a,{presType:parseInt(a.presType),presStrength:parseFloat(a.presStrength),presFreq:parseFloat(a.presFreq),lastTime:parseFloat(a.lastTime),pauseTime:parseInt(a.pauseTime),repeatCount:parseInt(a.repeatCount),totalCount:parseInt(a.totalCount),totalTime:parseInt(a.totalTime),tbsType:null!==a.tbsType&&void 0!==a.tbsType?parseInt(a.tbsType):null,innerPulseCount:null!==a.innerPulseCount&&void 0!==a.innerPulseCount?parseInt(a.innerPulseCount):null,outerFreq:null!==a.outerFreq&&void 0!==a.outerFreq?parseFloat(a.outerFreq):null,status:parseInt(a.status)}),i=e.stimulationSiteOptions.find(function(e){return e.value===r.presPartId});r.presPartName=i?i.label:"";var n=Object(c.d)(r,e.stimulationSiteOptions.map(function(e){return e.label}));if(!n.valid)return void e.$message.error(n.message);e.loading=!0,e.$postJson("/prescription",r).then(function(){e.reset(),e.$emit("success")}).catch(function(){e.loading=!1})}})},showStandardPrescriptionModal:function(){this.$emit("openStandardPrescriptionModal")},applyStandardPrescription:function(e){this.selectedStandardPrescriptionName=e.indication1+" - "+e.indication2;var t={presFreq:e.presFreq,lastTime:e.lastTime,pauseTime:e.pauseTime,repeatCount:e.repeatCount,totalTime:60*e.totalTime,presPartId:this.getSiteIdByName(e.presPart),presPartName:e.presPart,standardPresName:this.selectedStandardPrescriptionName};this.form.setFieldsValue(t),this.$message.success("标准处方参数已自动填充")},getSiteIdByName:function(e){var t=this.stimulationSiteOptions.find(function(t){return t.label===e});return t?t.value:null},setupFormWatchers:function(){var e=this;this.formWatcher=setInterval(function(){e.autoCalculateTotalCount()},500)},onPresTypeChange:function(e){var t=parseInt(e);if(this.isTBSMode=1===t,0===t)this.form.setFieldsValue({tbsType:null,innerFreq:null,innerCount:null,interFreq:null,interCount:null});else if(1===t){this.form.setFieldsValue({tbsType:0});var a=Object(c.c)(0);this.form.setFieldsValue(a)}this.autoCalculateTotalCount()},onTBSTypeChange:function(e){var t=Object(c.c)(parseInt(e));this.form.setFieldsValue(t),this.autoCalculateTotalCount()},autoCalculateTotalCount:function(){var e=this.form.getFieldsValue(),t=parseInt(e.presType);if(0===t){var a=Object(c.a)(parseFloat(e.presFreq)||0,parseFloat(e.lastTime)||0,parseInt(e.repeatCount)||0);a>0&&this.form.setFieldsValue({totalCount:a})}else if(1===t){var r=Object(c.b)(parseInt(e.innerCount)||0,parseInt(e.interCount)||0,parseInt(e.periods)||1);r>0&&this.form.setFieldsValue({totalCount:r})}}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{title:"新增处方",width:900},on:{cancel:e.onClose},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[a("template",{slot:"footer"},[a("a-button",{key:"back",on:{click:e.onClose}},[e._v("取消")]),e._v(" "),a("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.handleSubmit}},[e._v("提交")])],1),e._v(" "),a("a-form",{attrs:{form:e.form,layout:"vertical"}},[a("a-row",{attrs:{gutter:20}},[a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"患者ID"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["patientId",{rules:[{required:!0,message:"请输入患者ID!"}]}],expression:"['patientId', { rules: [{ required: true, message: '请输入患者ID!' }] }]"}]})],1)],1),e._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"医院ID"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["hospitalId",{rules:[{required:!0,message:"请输入医院ID!"}]}],expression:"['hospitalId', { rules: [{ required: true, message: '请输入医院ID!' }] }]"}]})],1)],1),e._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"医生ID"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["doctorId",{rules:[{required:!0,message:"请输入医生ID!"}]}],expression:"['doctorId', { rules: [{ required: true, message: '请输入医生ID!' }] }]"}]})],1)],1),e._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"处方类型"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["presType",{initialValue:0,rules:[{required:!0,message:"请选择处方类型!"}]}],expression:"['presType', { initialValue: 0, rules: [{ required: true, message: '请选择处方类型!' }] }]"}],on:{change:e.onPresTypeChange}},[a("a-select-option",{attrs:{value:"0"}},[e._v("普通处方")]),e._v(" "),a("a-select-option",{attrs:{value:"1"}},[e._v("TBS处方")])],1)],1)],1),e._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"刺激强度(%)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["presStrength",{initialValue:80,rules:[{required:!0,message:"请输入刺激强度!"}]}],expression:"['presStrength', { initialValue: 80, rules: [{ required: true, message: '请输入刺激强度!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:100}})],1)],1),e._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"刺激频率(Hz)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["presFreq",{initialValue:10,rules:[{required:!0,message:"请输入刺激频率!"}]}],expression:"['presFreq', { initialValue: 10.0, rules: [{ required: true, message: '请输入刺激频率!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:50,step:.1}})],1)],1),e._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"刺激时间(秒)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["lastTime",{initialValue:5,rules:[{required:!0,message:"请输入刺激时间!"}]}],expression:"['lastTime', { initialValue: 5.0, rules: [{ required: true, message: '请输入刺激时间!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:60,step:.1}})],1)],1),e._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"间歇时间(秒)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["pauseTime",{initialValue:25,rules:[{required:!0,message:"请输入间歇时间!"}]}],expression:"['pauseTime', { initialValue: 25, rules: [{ required: true, message: '请输入间歇时间!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:300}})],1)],1),e._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"重复次数(次)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["repeatCount",{initialValue:40,rules:[{required:!0,message:"请输入重复次数!"}]}],expression:"['repeatCount', { initialValue: 40, rules: [{ required: true, message: '请输入重复次数!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:1e3}})],1)],1),e._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"周期数(个)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["periods",{initialValue:1,rules:[{required:!0,message:"请输入周期数!"}]}],expression:"['periods', { initialValue: 1, rules: [{ required: true, message: '请输入周期数!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:1,max:1e3}})],1)],1),e._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"总脉冲数(个)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["totalCount",{initialValue:200,rules:[{required:!0,message:"请输入总脉冲数!"}]}],expression:"['totalCount', { initialValue: 200, rules: [{ required: true, message: '请输入总脉冲数!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:1e4}})],1)],1),e._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"总时间(秒)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["totalTime",{initialValue:1200,rules:[{required:!0,message:"请输入总时间!"}]}],expression:"['totalTime', { initialValue: 1200, rules: [{ required: true, message: '请输入总时间!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:7200}})],1)],1),e._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"治疗部位"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["presPartId",{rules:[{required:!0,message:"请选择治疗部位!"}]}],expression:"['presPartId', { rules: [{ required: true, message: '请选择治疗部位!' }] }]"}],attrs:{placeholder:"请选择治疗部位"}},e._l(e.stimulationSiteOptions,function(t){return a("a-select-option",{key:t.value,attrs:{value:t.value}},[e._v("\n            ["+e._s(t.category)+"] "+e._s(t.label)+"\n          ")])}),1)],1)],1),e._v(" "),a("a-col",{attrs:{md:12,sm:24}},[a("a-form-item",{attrs:{label:"标准处方",labelCol:{span:6},wrapperCol:{span:17}}},[a("a-row",{attrs:{gutter:16}},[a("a-col",{attrs:{span:16}},[a("a-input",{staticStyle:{cursor:"pointer"},attrs:{placeholder:"点击选择标准处方",readonly:""},on:{click:e.showStandardPrescriptionModal},model:{value:e.selectedStandardPrescriptionName,callback:function(t){e.selectedStandardPrescriptionName=t},expression:"selectedStandardPrescriptionName"}})],1),e._v(" "),a("a-col",{attrs:{span:8}},[a("a-button",{attrs:{type:"primary",icon:"search"},on:{click:e.showStandardPrescriptionModal}},[e._v("\n                  选择标准处方\n                ")])],1)],1)],1)],1),e._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"TBS类型"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["tbsType",{initialValue:null}],expression:"['tbsType', { initialValue: null }]"}],attrs:{disabled:!e.isTBSMode},on:{change:e.onTBSTypeChange}},[a("a-select-option",{attrs:{value:"0"}},[e._v("iTBS")]),e._v(" "),a("a-select-option",{attrs:{value:"1"}},[e._v("cTBS")])],1)],1)],1),e._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"丛内频率(Hz)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["innerFreq",{initialValue:null}],expression:"['innerFreq', { initialValue: null }]"}],staticStyle:{width:"100%"},attrs:{min:.1,max:200,step:.1,disabled:""}})],1)],1),e._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"丛内个数(个)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["innerCount",{initialValue:null}],expression:"['innerCount', { initialValue: null }]"}],staticStyle:{width:"100%"},attrs:{min:1,max:200,disabled:""}})],1)],1),e._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"丛间频率(Hz)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["interFreq",{initialValue:null}],expression:"['interFreq', { initialValue: null }]"}],staticStyle:{width:"100%"},attrs:{min:.1,max:200,step:.1,disabled:""}})],1)],1),e._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"丛间个数(个)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["interCount",{initialValue:null}],expression:"['interCount', { initialValue: null }]"}],staticStyle:{width:"100%"},attrs:{min:1,max:200,disabled:""}})],1)],1),e._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"状态"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["status",{initialValue:0}],expression:"['status', { initialValue: 0 }]"}]},[a("a-select-option",{attrs:{value:"0"}},[e._v("草稿")]),e._v(" "),a("a-select-option",{attrs:{value:"1"}},[e._v("已下发")]),e._v(" "),a("a-select-option",{attrs:{value:"2"}},[e._v("执行中")]),e._v(" "),a("a-select-option",{attrs:{value:"3"}},[e._v("完成")]),e._v(" "),a("a-select-option",{attrs:{value:"4"}},[e._v("异常")])],1)],1)],1)],1)],1)],2)},staticRenderFns:[]},p=a("VU/8")(m,d,!1,function(e){a("8v8l")},"data-v-cc24a788",null);t.default=p.exports}});