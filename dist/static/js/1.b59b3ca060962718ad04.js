webpackJsonp([1,34,47,49,58,66,70],{"8v8l":function(t,e){},FB2O:function(t,e){},"G+ZR":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("Xxa5"),i=a.n(r),s=a("Dd8w"),n=a.n(s),o=a("exGp"),l=a.n(o),c=a("Mqi+"),d={name:"PatientSelectModal",props:{visible:{type:Boolean,default:!1}},data:function(){return{loading:!1,tableLoading:!1,patientList:[],selectedPatient:null,searchParams:{name:"",code:""},pagination:{current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:function(t,e){return"第 "+e[0]+"-"+e[1]+" 条/共 "+t+" 条"}},columns:[{title:"所属医院",dataIndex:"hospitalId",key:"hospitalId",scopedSlots:{customRender:"hospitalId"}},{title:"所属科室",dataIndex:"departmentId",key:"departmentId",scopedSlots:{customRender:"departmentId"}},{title:"患者姓名",dataIndex:"name",key:"name"},{title:"性别",dataIndex:"gender",key:"gender",scopedSlots:{customRender:"gender"}},{title:"出生日期",dataIndex:"birthday",key:"birthday"},{title:"患者唯一码",dataIndex:"code",key:"code"},{title:"状态",dataIndex:"status",key:"status",scopedSlots:{customRender:"status"}},{title:"创建时间",dataIndex:"createTime",key:"createTime"}],hospitalDict:c.c,departmentDict:c.a}},computed:{rowSelection:function(){return{type:"radio",selectedRowKeys:this.selectedPatient?[this.selectedPatient.id]:[],onChange:this.onSelectChange}}},watch:{visible:function(t){t&&this.loadPatientList()}},methods:{loadPatientList:function(){var t=this;return l()(i.a.mark(function e(){var a,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.tableLoading=!0,e.prev=1,a=n()({pageNum:t.pagination.current,pageSize:t.pagination.pageSize},t.searchParams),e.next=5,t.$get("/patient/page",a);case 5:(r=e.sent)&&r.data&&(t.patientList=r.data.records||r.data.list||[],t.pagination.total=r.data.total||0),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),t.$message.error("加载患者列表失败");case 13:return e.prev=13,t.tableLoading=!1,e.finish(13);case 16:case"end":return e.stop()}},e,t,[[1,9,13,16]])}))()},handleSearch:function(){this.pagination.current=1,this.loadPatientList()},handleReset:function(){this.searchParams={name:"",code:""},this.pagination.current=1,this.loadPatientList()},handleTableChange:function(t){this.pagination.current=t.current,this.pagination.pageSize=t.pageSize,this.loadPatientList()},onSelectChange:function(t,e){this.selectedPatient=e.length>0?e[0]:null},handleOk:function(){this.selectedPatient?(this.loading=!0,this.$emit("patientSelected",this.selectedPatient),this.loading=!1):this.$message.warning("请选择一个患者")},handleCancel:function(){this.selectedPatient=null,this.$emit("cancel")}}},p={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-modal",{attrs:{title:"选择患者",visible:t.visible,confirmLoading:t.loading,width:"1000px",maskClosable:!1},on:{ok:t.handleOk,cancel:t.handleCancel}},[a("div",{staticClass:"search-area"},[a("a-row",{attrs:{gutter:16}},[a("a-col",{attrs:{span:8}},[a("a-input",{attrs:{placeholder:"患者姓名",allowClear:""},on:{change:t.handleSearch},model:{value:t.searchParams.name,callback:function(e){t.$set(t.searchParams,"name",e)},expression:"searchParams.name"}})],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-input",{attrs:{placeholder:"患者唯一码",allowClear:""},on:{change:t.handleSearch},model:{value:t.searchParams.code,callback:function(e){t.$set(t.searchParams,"code",e)},expression:"searchParams.code"}})],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-button",{attrs:{type:"primary",icon:"search"},on:{click:t.handleSearch}},[t._v("\n          搜索\n        ")]),t._v(" "),a("a-button",{staticStyle:{"margin-left":"8px"},on:{click:t.handleReset}},[t._v("\n          重置\n        ")])],1)],1)],1),t._v(" "),a("a-table",{attrs:{columns:t.columns,dataSource:t.patientList,loading:t.tableLoading,pagination:t.pagination,rowSelection:t.rowSelection,scroll:{y:400},rowKey:"id"},on:{change:t.handleTableChange},scopedSlots:t._u([{key:"hospitalId",fn:function(e){return[t._v("\n      "+t._s(t.hospitalDict[e]||e)+"\n    ")]}},{key:"departmentId",fn:function(e){return[t._v("\n      "+t._s(t.departmentDict[e]||e)+"\n    ")]}},{key:"gender",fn:function(e){return[t._v("\n      "+t._s("M"===e?"男":"F"===e?"女":"")+"\n    ")]}},{key:"status",fn:function(e){return["online"===e?a("a-tag",{attrs:{color:"green"}},[t._v("在线")]):"offline"===e?a("a-tag",{attrs:{color:"red"}},[t._v("离线")]):"error"===e?a("a-tag",{attrs:{color:"orange"}},[t._v("故障")]):"unknown"===e?a("a-tag",[t._v("未知")]):a("span",[t._v(t._s(e||"-"))])]}}])})],1)},staticRenderFns:[]},u=a("VU/8")(d,p,!1,function(t){a("QQFf")},"data-v-4f783bb2",null);e.default=u.exports},Hzcl:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("Mqi+"),i={name:"PrescriptionView",props:{prescriptionShow:{type:Boolean,default:!1},prescriptionData:{type:Object}},data:function(){return{hospitalDict:r.c}},computed:{show:{get:function(){return this.prescriptionShow},set:function(){}}},methods:{onClose:function(){this.$emit("close")},getStatusText:function(t){return{0:"草稿",1:"已下发",2:"执行中",3:"完成",4:"异常"}[t]||t},getPresTypeText:function(t){return{0:"普通处方",1:"TBS处方"}[t]||t},getTbsTypeText:function(t){return{0:"iTBS",1:"cTBS"}[t]||t}}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-modal",{attrs:{title:"处方详情",width:900},on:{cancel:t.onClose},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[a("template",{slot:"footer"},[a("a-button",{key:"back",attrs:{type:"danger"},on:{click:t.onClose}},[t._v("关闭")])],1),t._v(" "),null!==t.prescriptionData?a("div",{staticStyle:{"font-size":"13px","font-family":"SimHei"}},[a("a-row",{staticStyle:{"padding-left":"24px","padding-right":"24px"}},[a("a-col",{staticStyle:{"margin-bottom":"15px"}},[a("span",{staticStyle:{"font-size":"15px","font-weight":"650",color:"#000c17"}},[t._v("基础信息")])]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("处方ID：")]),t._v(t._s(t.prescriptionData.id))]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("患者ID：")]),t._v(t._s(t.prescriptionData.patientId))]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("医院ID：")]),t._v(t._s(t.hospitalDict[t.prescriptionData.hospitalId]||t.prescriptionData.hospitalId))])],1),t._v(" "),a("br"),t._v(" "),a("a-row",{staticStyle:{"padding-left":"24px","padding-right":"24px"}},[a("a-col",{attrs:{span:8}},[a("b",[t._v("医生ID：")]),t._v(t._s(t.prescriptionData.doctorId))]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("处方类型：")]),t._v(" "),0==t.prescriptionData.presType?a("a-tag",{attrs:{color:"blue"}},[t._v("普通处方")]):1==t.prescriptionData.presType?a("a-tag",{attrs:{color:"green"}},[t._v("TBS处方")]):a("span",[t._v(t._s(t.getPresTypeText(t.prescriptionData.presType)||t.prescriptionData.presType||"-"))])],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("状态：")]),t._v(" "),0==t.prescriptionData.status?a("a-tag",{staticStyle:{"border-color":"#d9d9d9",color:"#666"},attrs:{color:"dashed"}},[t._v("草稿")]):1==t.prescriptionData.status?a("a-tag",{attrs:{color:"blue"}},[t._v("已下发")]):2==t.prescriptionData.status?a("a-tag",{attrs:{color:"orange"}},[t._v("执行中")]):3==t.prescriptionData.status?a("a-tag",{attrs:{color:"green"}},[t._v("完成")]):4==t.prescriptionData.status?a("a-tag",{attrs:{color:"red"}},[t._v("异常")]):a("span",[t._v(t._s(t.getStatusText(t.prescriptionData.status)||t.prescriptionData.status||"-"))])],1)],1),t._v(" "),a("br"),t._v(" "),a("a-row",{staticStyle:{"padding-left":"24px","padding-right":"24px"}},[a("a-col",{staticStyle:{"margin-bottom":"15px"}},[a("span",{staticStyle:{"font-size":"15px","font-weight":"650",color:"#000c17"}},[t._v("处方参数")])]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("刺激强度：")]),t._v(t._s(t.prescriptionData.presStrength))]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("刺激频率：")]),t._v(t._s(t.prescriptionData.presFreq))]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("刺激时间(秒)：")]),t._v(t._s(t.prescriptionData.lastTime))])],1),t._v(" "),a("br"),t._v(" "),a("a-row",{staticStyle:{"padding-left":"24px","padding-right":"24px"}},[a("a-col",{attrs:{span:8}},[a("b",[t._v("间歇时间(秒)：")]),t._v(t._s(t.prescriptionData.pauseTime))]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("重复次数：")]),t._v(t._s(t.prescriptionData.repeatCount))]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("周期数：")]),t._v(t._s(t.prescriptionData.periods||1))]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("总脉冲数：")]),t._v(t._s(t.prescriptionData.totalCount))])],1),t._v(" "),a("br"),t._v(" "),a("a-row",{staticStyle:{"padding-left":"24px","padding-right":"24px"}},[a("a-col",{attrs:{span:8}},[a("b",[t._v("总时间(秒)：")]),t._v(t._s(t.prescriptionData.totalTime))]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("治疗部位：")]),t._v(t._s(t.prescriptionData.presPartName||"-"))]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("标准处方：")]),t._v(t._s(t.prescriptionData.standardPresName||"-"))])],1),t._v(" "),a("br"),t._v(" "),a("a-row",{staticStyle:{"padding-left":"24px","padding-right":"24px"}},[a("a-col",{staticStyle:{"margin-bottom":"15px"}},[a("span",{staticStyle:{"font-size":"15px","font-weight":"650",color:"#000c17"}},[t._v("TBS专用参数")])]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("TBS类型：")]),t._v(" "),0==t.prescriptionData.tbsType?a("a-tag",{attrs:{color:"purple"}},[t._v("iTBS")]):1==t.prescriptionData.tbsType?a("a-tag",{attrs:{color:"cyan"}},[t._v("cTBS")]):a("span",[t._v(t._s(t.getTbsTypeText(t.prescriptionData.tbsType)||t.prescriptionData.tbsType||"-"))])],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("丛内频率：")]),t._v(t._s(t.prescriptionData.innerFreq||"-"))]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("丛内个数：")]),t._v(t._s(t.prescriptionData.innerCount||"-"))]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("丛间频率：")]),t._v(t._s(t.prescriptionData.interFreq||"-"))]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("丛间个数：")]),t._v(t._s(t.prescriptionData.interCount||"-"))])],1),t._v(" "),a("br"),t._v(" "),a("a-row",{staticStyle:{"padding-left":"24px","padding-right":"24px"}},[a("a-col",{staticStyle:{"margin-bottom":"15px"}},[a("span",{staticStyle:{"font-size":"15px","font-weight":"650",color:"#000c17"}},[t._v("审计信息")])]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("创建人：")]),t._v(t._s(t.prescriptionData.createBy||"-"))]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("创建时间：")]),t._v(t._s(t.prescriptionData.createTime))]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("更新人：")]),t._v(t._s(t.prescriptionData.updateBy||"-"))])],1),t._v(" "),a("br"),t._v(" "),a("a-row",{staticStyle:{"padding-left":"24px","padding-right":"24px"}},[a("a-col",{attrs:{span:8}},[a("b",[t._v("更新时间：")]),t._v(t._s(t.prescriptionData.updateTime||"-"))]),t._v(" "),a("a-col",{attrs:{span:8}},[a("b",[t._v("备注：")]),t._v(t._s(t.prescriptionData.remark||"-"))])],1)],1):t._e()],2)},staticRenderFns:[]},n=a("VU/8")(i,s,!1,function(t){a("krl9")},"data-v-731b2586",null);e.default=n.exports},Jm97:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("Dd8w"),i=a.n(r),s=a("Xxa5"),n=a.n(s),o=a("exGp"),l=a.n(o),c=a("Mqi+"),d=a("jmyz"),p={name:"PrescriptionEdit",props:{prescriptionEditVisiable:{default:!1}},computed:{show:{get:function(){return this.prescriptionEditVisiable},set:function(){}}},data:function(){return{form:this.$form.createForm(this),loading:!1,rowId:null,selectedStandardPrescriptionName:"",stimulationSiteOptions:[],isTBSMode:!1}},mounted:function(){var t=this;return l()(n.a.mark(function e(){return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(c.b)(t);case 2:t.stimulationSiteOptions=e.sent,t.$nextTick(function(){t.setupFormWatchers()});case 4:case"end":return e.stop()}},e,t)}))()},methods:{setFormValues:function(t){this.rowId=t.id;var e={};["patientId","hospitalId","doctorId","presType","presStrength","presFreq","lastTime","pauseTime","repeatCount","periods","totalCount","totalTime","presPartId","presPartName","standardPresName","tbsType","innerFreq","innerCount","interFreq","interCount","status"].forEach(function(a){e[a]=t[a]}),this.form.setFieldsValue(e),this.isTBSMode=1===parseInt(t.presType),this.selectedStandardPrescriptionName=t.standardPresName||""},reset:function(){this.loading=!1,this.form.resetFields(),this.selectedStandardPrescriptionName="",this.formWatcher&&(clearInterval(this.formWatcher),this.formWatcher=null)},onClose:function(){this.reset(),this.$emit("close")},beforeDestroy:function(){this.formWatcher&&(clearInterval(this.formWatcher),this.formWatcher=null)},handleSubmit:function(){var t=this;this.form.validateFields(function(e,a){if(!e){var r=i()({},a,{id:t.rowId,presType:parseInt(a.presType),presStrength:parseFloat(a.presStrength),presFreq:parseFloat(a.presFreq),lastTime:parseFloat(a.lastTime),pauseTime:parseInt(a.pauseTime),repeatCount:parseInt(a.repeatCount),totalCount:parseInt(a.totalCount),totalTime:parseInt(a.totalTime),tbsType:null!==a.tbsType&&void 0!==a.tbsType?parseInt(a.tbsType):null,innerFreq:null!==a.innerFreq&&void 0!==a.innerFreq?parseFloat(a.innerFreq):null,innerCount:null!==a.innerCount&&void 0!==a.innerCount?parseInt(a.innerCount):null,interFreq:null!==a.interFreq&&void 0!==a.interFreq?parseFloat(a.interFreq):null,interCount:null!==a.interCount&&void 0!==a.interCount?parseInt(a.interCount):null,periods:null!==a.periods&&void 0!==a.periods?parseInt(a.periods):1,status:parseInt(a.status)}),s=t.stimulationSiteOptions.find(function(t){return t.value===r.presPartId});r.presPartName=s?s.label:"";var n=Object(d.d)(r,t.stimulationSiteOptions.map(function(t){return t.label}));if(!n.valid)return void t.$message.error(n.message);t.loading=!0,t.$putJson("/prescription",r).then(function(){t.reset(),t.$emit("success")}).catch(function(){t.loading=!1})}})},showStandardPrescriptionModal:function(){this.$emit("openStandardPrescriptionModal")},applyStandardPrescription:function(t){this.selectedStandardPrescriptionName=t.indication1+" - "+t.indication2;var e={presFreq:t.presFreq,lastTime:t.lastTime,pauseTime:t.pauseTime,repeatCount:t.repeatCount,totalTime:60*t.totalTime,presPartId:this.getSiteIdByName(t.presPart),presPartName:t.presPart,standardPresName:this.selectedStandardPrescriptionName};this.form.setFieldsValue(e),this.$message.success("标准处方参数已自动填充")},getSiteIdByName:function(t){var e=this.stimulationSiteOptions.find(function(e){return e.label===t});return e?e.value:null},setupFormWatchers:function(){var t=this;this.formWatcher=setInterval(function(){t.autoCalculateTotalCount()},500)},onPresTypeChange:function(t){var e=parseInt(t);if(this.isTBSMode=1===e,0===e)this.form.setFieldsValue({tbsType:null,innerFreq:null,innerCount:null,interFreq:null,interCount:null});else if(1===e){this.form.setFieldsValue({tbsType:0});var a=Object(d.c)(0);this.form.setFieldsValue(a)}this.autoCalculateTotalCount()},onTBSTypeChange:function(t){var e=Object(d.c)(parseInt(t));this.form.setFieldsValue(e),this.autoCalculateTotalCount()},autoCalculateTotalCount:function(){var t=this.form.getFieldsValue(),e=parseInt(t.presType);if(0===e){var a=Object(d.a)(parseFloat(t.presFreq)||0,parseFloat(t.lastTime)||0,parseInt(t.repeatCount)||0);a>0&&this.form.setFieldsValue({totalCount:a})}else if(1===e){var r=Object(d.b)(parseInt(t.innerCount)||0,parseInt(t.interCount)||0,parseInt(t.periods)||1);r>0&&this.form.setFieldsValue({totalCount:r})}}}},u={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-modal",{attrs:{title:"编辑处方",width:900},on:{cancel:t.onClose},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[a("template",{slot:"footer"},[a("a-button",{key:"back",on:{click:t.onClose}},[t._v("取消")]),t._v(" "),a("a-button",{key:"submit",attrs:{type:"primary",loading:t.loading},on:{click:t.handleSubmit}},[t._v("修改")])],1),t._v(" "),a("a-form",{attrs:{form:t.form,layout:"vertical"}},[a("a-row",{attrs:{gutter:20}},[a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"患者ID"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["patientId",{rules:[{required:!0,message:"请输入患者ID!"}]}],expression:"['patientId', { rules: [{ required: true, message: '请输入患者ID!' }] }]"}]})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"医院ID"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["hospitalId",{rules:[{required:!0,message:"请输入医院ID!"}]}],expression:"['hospitalId', { rules: [{ required: true, message: '请输入医院ID!' }] }]"}]})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"医生ID"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["doctorId",{rules:[{required:!0,message:"请输入医生ID!"}]}],expression:"['doctorId', { rules: [{ required: true, message: '请输入医生ID!' }] }]"}]})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"处方类型"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["presType",{rules:[{required:!0,message:"请选择处方类型!"}]}],expression:"['presType', { rules: [{ required: true, message: '请选择处方类型!' }] }]"}],on:{change:t.onPresTypeChange}},[a("a-select-option",{attrs:{value:"0"}},[t._v("普通处方")]),t._v(" "),a("a-select-option",{attrs:{value:"1"}},[t._v("TBS处方")])],1)],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"刺激强度(%)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["presStrength",{rules:[{required:!0,message:"请输入刺激强度!"}]}],expression:"['presStrength', { rules: [{ required: true, message: '请输入刺激强度!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:100}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"刺激频率(Hz)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["presFreq",{rules:[{required:!0,message:"请输入刺激频率!"}]}],expression:"['presFreq', { rules: [{ required: true, message: '请输入刺激频率!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:50,step:.1}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"刺激时间(秒)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["lastTime",{rules:[{required:!0,message:"请输入刺激时间!"}]}],expression:"['lastTime', { rules: [{ required: true, message: '请输入刺激时间!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:60,step:.1}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"间歇时间(秒)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["pauseTime",{rules:[{required:!0,message:"请输入间歇时间!"}]}],expression:"['pauseTime', { rules: [{ required: true, message: '请输入间歇时间!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:300}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"重复次数(次)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["repeatCount",{rules:[{required:!0,message:"请输入重复次数!"}]}],expression:"['repeatCount', { rules: [{ required: true, message: '请输入重复次数!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:1e3}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"周期数(个)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["periods",{rules:[{required:!0,message:"请输入周期数!"}]}],expression:"['periods', { rules: [{ required: true, message: '请输入周期数!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:1,max:1e3}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"总脉冲数(个)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["totalCount",{rules:[{required:!0,message:"请输入总脉冲数!"}]}],expression:"['totalCount', { rules: [{ required: true, message: '请输入总脉冲数!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:1e4}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"总时间(秒)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["totalTime",{rules:[{required:!0,message:"请输入总时间!"}]}],expression:"['totalTime', { rules: [{ required: true, message: '请输入总时间!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:7200}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"治疗部位"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["presPartId",{rules:[{required:!0,message:"请选择治疗部位!"}]}],expression:"['presPartId', { rules: [{ required: true, message: '请选择治疗部位!' }] }]"}],attrs:{placeholder:"请选择治疗部位"}},t._l(t.stimulationSiteOptions,function(e){return a("a-select-option",{key:e.value,attrs:{value:e.value}},[t._v("\n            ["+t._s(e.category)+"] "+t._s(e.label)+"\n          ")])}),1)],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"标准处方"}},[a("a-row",{attrs:{gutter:16}},[a("a-col",{attrs:{span:16}},[a("a-input",{staticStyle:{cursor:"pointer"},attrs:{placeholder:"点击选择标准处方",readonly:""},on:{click:t.showStandardPrescriptionModal},model:{value:t.selectedStandardPrescriptionName,callback:function(e){t.selectedStandardPrescriptionName=e},expression:"selectedStandardPrescriptionName"}})],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-button",{attrs:{type:"primary",icon:"search"},on:{click:t.showStandardPrescriptionModal}},[t._v("\n                选择\n              ")])],1)],1)],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"TBS类型"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["tbsType"],expression:"['tbsType']"}],attrs:{disabled:!t.isTBSMode},on:{change:t.onTBSTypeChange}},[a("a-select-option",{attrs:{value:"0"}},[t._v("iTBS")]),t._v(" "),a("a-select-option",{attrs:{value:"1"}},[t._v("cTBS")])],1)],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"丛内频率(Hz)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["innerFreq"],expression:"['innerFreq']"}],staticStyle:{width:"100%"},attrs:{min:.1,max:200,step:.1,disabled:""}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"丛内个数(个)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["innerCount"],expression:"['innerCount']"}],staticStyle:{width:"100%"},attrs:{min:1,max:200,disabled:""}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"丛间频率(Hz)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["interFreq"],expression:"['interFreq']"}],staticStyle:{width:"100%"},attrs:{min:.1,max:200,step:.1,disabled:""}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"丛间个数(个)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["interCount"],expression:"['interCount']"}],staticStyle:{width:"100%"},attrs:{min:1,max:200,disabled:""}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"状态"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["status"],expression:"['status']"}]},[a("a-select-option",{attrs:{value:"0"}},[t._v("草稿")]),t._v(" "),a("a-select-option",{attrs:{value:"1"}},[t._v("已下发")]),t._v(" "),a("a-select-option",{attrs:{value:"2"}},[t._v("执行中")]),t._v(" "),a("a-select-option",{attrs:{value:"3"}},[t._v("完成")]),t._v(" "),a("a-select-option",{attrs:{value:"4"}},[t._v("异常")])],1)],1)],1)],1)],1)],2)},staticRenderFns:[]},v=a("VU/8")(p,u,!1,function(t){a("Ubkq")},"data-v-54b7e0b3",null);e.default=v.exports},QQFf:function(t,e){},Sx62:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("Xxa5"),i=a.n(r),s=a("Dd8w"),n=a.n(s),o=a("exGp"),l=a.n(o),c=a("Mqi+"),d={name:"DeviceSelectModal",props:{visible:{type:Boolean,default:!1}},data:function(){return{loading:!1,tableLoading:!1,deviceList:[],selectedDevice:null,searchParams:{hospitalId:"",sn:"",status:void 0},pagination:{current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:function(t,e){return"第 "+e[0]+"-"+e[1]+" 条/共 "+t+" 条"}},columns:[{title:"设备ID",dataIndex:"deviceId",key:"deviceId"},{title:"医院ID",dataIndex:"hospitalId",key:"hospitalId",scopedSlots:{customRender:"hospitalId"}},{title:"设备类型",dataIndex:"deviceType",key:"deviceType"},{title:"SN码",dataIndex:"sn",key:"sn"},{title:"状态",dataIndex:"status",key:"status",scopedSlots:{customRender:"status"}},{title:"最后心跳时间",dataIndex:"lastHeartbeat",key:"lastHeartbeat"},{title:"预留字段1",dataIndex:"extendField1",key:"extendField1"},{title:"预留字段2",dataIndex:"extendField2",key:"extendField2"},{title:"预留字段3",dataIndex:"extendField3",key:"extendField3"}],hospitalDict:c.c}},computed:{rowSelection:function(){return{type:"radio",selectedRowKeys:this.selectedDevice?[this.selectedDevice.deviceId]:[],onChange:this.onSelectChange}}},watch:{visible:function(t){t&&this.loadDeviceList()}},methods:{loadDeviceList:function(){var t=this;return l()(i.a.mark(function e(){var a,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.tableLoading=!0,e.prev=1,a=n()({pageNum:t.pagination.current,pageSize:t.pagination.pageSize},t.searchParams),e.next=5,t.$get("/device/page",a);case 5:(r=e.sent)&&r.data&&(t.deviceList=r.data.records||r.data.list||[],t.pagination.total=r.data.total||0),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),t.$message.error("加载设备列表失败");case 13:return e.prev=13,t.tableLoading=!1,e.finish(13);case 16:case"end":return e.stop()}},e,t,[[1,9,13,16]])}))()},handleSearch:function(){this.pagination.current=1,this.loadDeviceList()},handleReset:function(){this.searchParams={hospitalId:"",sn:"",status:void 0},this.pagination.current=1,this.loadDeviceList()},handleTableChange:function(t){this.pagination.current=t.current,this.pagination.pageSize=t.pageSize,this.loadDeviceList()},onSelectChange:function(t,e){this.selectedDevice=e.length>0?e[0]:null},handleOk:function(){return this.selectedDevice?"online"!==this.selectedDevice.status?void this.$message.error("只能选择在线状态的设备进行下发"):(this.loading=!0,this.$emit("deviceSelected",this.selectedDevice),void(this.loading=!1)):void this.$message.warning("请选择一个设备")},handleCancel:function(){this.selectedDevice=null,this.$emit("cancel")}}},p={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-modal",{attrs:{title:"选择设备",visible:t.visible,confirmLoading:t.loading,width:"1200px",maskClosable:!1},on:{ok:t.handleOk,cancel:t.handleCancel}},[a("div",{staticClass:"search-area"},[a("a-row",{attrs:{gutter:16}},[a("a-col",{attrs:{span:6}},[a("a-input",{attrs:{placeholder:"医院ID",allowClear:""},on:{change:t.handleSearch},model:{value:t.searchParams.hospitalId,callback:function(e){t.$set(t.searchParams,"hospitalId",e)},expression:"searchParams.hospitalId"}})],1),t._v(" "),a("a-col",{attrs:{span:6}},[a("a-input",{attrs:{placeholder:"设备SN码",allowClear:""},on:{change:t.handleSearch},model:{value:t.searchParams.sn,callback:function(e){t.$set(t.searchParams,"sn",e)},expression:"searchParams.sn"}})],1),t._v(" "),a("a-col",{attrs:{span:6}},[a("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"设备状态",allowClear:""},on:{change:t.handleSearch},model:{value:t.searchParams.status,callback:function(e){t.$set(t.searchParams,"status",e)},expression:"searchParams.status"}},[a("a-select-option",{attrs:{value:"online"}},[t._v("在线")]),t._v(" "),a("a-select-option",{attrs:{value:"offline"}},[t._v("离线")]),t._v(" "),a("a-select-option",{attrs:{value:"error"}},[t._v("故障")]),t._v(" "),a("a-select-option",{attrs:{value:"unknown"}},[t._v("未知")])],1)],1),t._v(" "),a("a-col",{attrs:{span:6}},[a("a-button",{attrs:{type:"primary",icon:"search"},on:{click:t.handleSearch}},[t._v("\n          搜索\n        ")]),t._v(" "),a("a-button",{staticStyle:{"margin-left":"8px"},on:{click:t.handleReset}},[t._v("\n          重置\n        ")])],1)],1)],1),t._v(" "),a("a-table",{attrs:{columns:t.columns,dataSource:t.deviceList,loading:t.tableLoading,pagination:t.pagination,rowSelection:t.rowSelection,scroll:{y:400},rowKey:"deviceId"},on:{change:t.handleTableChange},scopedSlots:t._u([{key:"hospitalId",fn:function(e){return[t._v("\n      "+t._s(t.hospitalDict[e]||e)+"\n    ")]}},{key:"status",fn:function(e){return["online"===e?a("a-tag",{attrs:{color:"green"}},[t._v("在线")]):"offline"===e?a("a-tag",{attrs:{color:"red"}},[t._v("离线")]):"error"===e?a("a-tag",{attrs:{color:"orange"}},[t._v("故障")]):"unknown"===e?a("a-tag",[t._v("未知")]):a("span",[t._v(t._s(e||"-"))])]}}])})],1)},staticRenderFns:[]},u=a("VU/8")(d,p,!1,function(t){a("FB2O")},"data-v-79f86543",null);e.default=u.exports},Ubkq:function(t,e){},bplz:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("Xxa5"),i=a.n(r),s=a("exGp"),n=a.n(s),o=a("fZjL"),l=a.n(o),c=(a("pFYg"),a("Dd8w")),d=a.n(c),p=a("eKKA"),u=a("Jm97"),v=a("Hzcl"),m=a("wMQb"),h=a("G+ZR"),_=a("Sx62"),f=a("Mqi+"),g=a("jmyz"),b={name:"Prescription",components:{prescriptionAdd:p.default,prescriptionEdit:u.default,prescriptionView:v.default,StandardPrescriptionModal:m.default,PatientSelectModal:h.default,DeviceSelectModal:_.default},data:function(){return{prescriptionAdd:{visiable:!1},prescriptionEdit:{visiable:!1},prescriptionView:{visiable:!1,data:null},standardPrescriptionModal:{visible:!1},patientSelectModal:{visible:!1},deviceSelectModal:{visible:!1},currentDispatchPrescription:null,selectedPatient:null,selectedDevice:null,currentEditingRow:null,queryParams:{},dataSource:[],loading:!1,selectedRowKeys:[],hospitalDict:f.c,stimulationSiteOptions:[],pagination:{pageSizeOptions:["10","20","30","40","100"],current:1,pageSize:10,showQuickJumper:!0,showSizeChanger:!0,showTotal:function(t,e){return"显示 "+e[0]+" ~ "+e[1]+" 条记录，共 "+t+" 条记录"},total:0}}},computed:{columns:function(){return[{title:"展开",dataIndex:"expand",width:40,scopedSlots:{customRender:"expand"}},{title:"处方ID",dataIndex:"id",width:80},{title:"患者ID",dataIndex:"patientId",width:80,scopedSlots:{customRender:"patientId"}},{title:"医院",dataIndex:"hospitalId",width:100,scopedSlots:{customRender:"hospitalId"}},{title:"医生ID",dataIndex:"doctorId",width:80,scopedSlots:{customRender:"doctorId"}},{title:"处方类型",dataIndex:"presType",width:90,scopedSlots:{customRender:"presType"}},{title:"治疗部位",dataIndex:"presPartName",width:120,scopedSlots:{customRender:"presPartName"}},{title:"标准处方",dataIndex:"standardPresName",width:120,scopedSlots:{customRender:"standardPresName"}},{title:"状态",dataIndex:"status",width:80,scopedSlots:{customRender:"status"}},{title:"创建时间",dataIndex:"createTime",width:120},{title:"操作",dataIndex:"operation",width:220,fixed:"right",scopedSlots:{customRender:"operation"}}]},rowSelection:function(){return{selectedRowKeys:this.selectedRowKeys,onChange:this.onSelectChange}}},methods:{search:function(t,e){var a=this;this.loading=!0;var r=d()({pageNum:t||this.pagination.current,pageSize:e||this.pagination.pageSize},this.queryParams);this.$get("/prescription/page",r).then(function(t){t&&t.data&&(a.dataSource=t.data.records||t.data.list||[],a.pagination.total=t.data.total||0,a.pagination.current=r.pageNum,a.pagination.pageSize=r.pageSize,a.dataSource.length),a.loading=!1}).catch(function(){a.loading=!1})},reset:function(){this.queryParams={presPartId:void 0},this.search()},add:function(){this.prescriptionAdd.visiable=!0},startEdit:function(t){t.originalData=d()({},t),this.$set(t,"editing",!0),this.currentEditingRow=t,0===parseInt(t.presType)&&(this.$set(t,"tbsType",null),this.$set(t,"innerFreq",null),this.$set(t,"innerCount",null),this.$set(t,"interFreq",null),this.$set(t,"interCount",null),this.$set(t,"periods",1))},saveRow:function(t){var e=this,a={id:t.id,patientId:parseInt(t.patientId),hospitalId:parseInt(t.hospitalId),doctorId:parseInt(t.doctorId),presType:parseInt(t.presType),presStrength:parseFloat(t.presStrength),presFreq:parseFloat(t.presFreq),lastTime:parseFloat(t.lastTime),pauseTime:parseInt(t.pauseTime),repeatCount:parseInt(t.repeatCount),periods:parseInt(t.periods)||1,totalCount:parseInt(t.totalCount),totalTime:parseInt(t.totalTime),presPartId:t.presPartId?parseInt(t.presPartId):null,presPartName:t.presPartName,standardPresName:t.standardPresName,tbsType:null!==t.tbsType&&void 0!==t.tbsType?parseInt(t.tbsType):null,innerFreq:null!==t.innerFreq&&void 0!==t.innerFreq?parseFloat(t.innerFreq):null,innerCount:null!==t.innerCount&&void 0!==t.innerCount?parseInt(t.innerCount):null,interFreq:null!==t.interFreq&&void 0!==t.interFreq?parseFloat(t.interFreq):null,interCount:null!==t.interCount&&void 0!==t.interCount?parseInt(t.interCount):null,status:parseInt(t.status)},r=this.stimulationSiteOptions.find(function(t){return t.value===a.presPartId});a.presPartName=r?r.label:"";var i=Object(g.d)(a,this.stimulationSiteOptions.map(function(t){return t.label}));i.valid?(this.loading=!0,this.$putJson("/prescription",a).then(function(){e.$message.success("保存成功"),e.$set(t,"editing",!1),delete t.originalData,e.currentEditingRow=null,e.loading=!1}).catch(function(){e.loading=!1})):this.$message.error(i.message)},cancelEdit:function(t){var e=this;t.originalData&&(l()(t.originalData).forEach(function(a){"editing"!==a&&"originalData"!==a&&e.$set(t,a,t.originalData[a])}),delete t.originalData),this.$set(t,"editing",!1),this.currentEditingRow=null},remove:function(t){var e=this;this.$confirm({title:"确认删除",content:"确定要删除这条处方记录吗？",onOk:function(){e.$delete("/prescription/"+t.id).then(function(){e.$message.success("删除成功"),e.search()})}})},batchDelete:function(){var t=this;0!==this.selectedRowKeys.length?this.$confirm({title:"确认批量删除",content:"确定要删除选中的 "+this.selectedRowKeys.length+" 条记录吗？",onOk:function(){t.$postJson("/prescription/batch",t.selectedRowKeys).then(function(){t.$message.success("批量删除成功"),t.selectedRowKeys=[],t.search()})}}):this.$message.warning("请选择要删除的记录")},onSelectChange:function(t){this.selectedRowKeys=t},handleTableChange:function(t){this.pagination.current=t.current,this.pagination.pageSize=t.pageSize,this.search()},handlePrescriptionAddClose:function(){this.prescriptionAdd.visiable=!1},handlePrescriptionAddSuccess:function(){this.prescriptionAdd.visiable=!1,this.search()},handlePrescriptionViewOpen:function(t){this.prescriptionView.data=t,this.prescriptionView.visiable=!0},handlePrescriptionViewClose:function(){this.prescriptionView.visiable=!1},exportExcel:function(){this.$export("prescription/excel",d()({},this.queryParams))},toggleExpand:function(t){this.$set(t,"expanded",!t.expanded)},getHospitalName:function(t){return t||0===t?this.hospitalDict[t]||this.hospitalDict[t.toString()]||this.hospitalDict[parseInt(t)]||t:"-"},getStatusText:function(t){return{0:"草稿",1:"已下发",2:"执行中",3:"完成",4:"异常"}[t]||t},getPresTypeText:function(t){return{0:"普通处方",1:"TBS处方"}[t]||t},handleOpenStandardPrescriptionModal:function(){this.currentEditingRow=null,this.standardPrescriptionModal.visible=!0},handleStandardPrescriptionSelected:function(t){this.prescriptionAdd.visiable&&this.$refs.prescriptionAdd?this.$refs.prescriptionAdd.applyStandardPrescription(t):this.prescriptionEdit.visiable&&this.$refs.prescriptionEdit?this.$refs.prescriptionEdit.applyStandardPrescription(t):this.currentEditingRow&&this.applyStandardPrescriptionToRow(this.currentEditingRow,t)},showStandardPrescriptionModalForRow:function(t){this.currentEditingRow=t,this.standardPrescriptionModal.visible=!0},applyStandardPrescriptionToRow:function(t,e){t.standardPresName=e.indication1+" - "+e.indication2,t.presFreq=e.presFreq,t.lastTime=e.lastTime,t.pauseTime=e.pauseTime,t.repeatCount=e.repeatCount,t.totalTime=60*e.totalTime;var a=this.stimulationSiteOptions.find(function(t){return t.label===e.presPart});t.presPartId=a?a.value:null,t.presPartName=e.presPart,this.$message.success("标准处方参数已自动填充到当前行"),this.currentEditingRow=null},handlePrescriptionEditClose:function(){this.prescriptionEdit.visiable=!1},handlePrescriptionEditSuccess:function(){this.prescriptionEdit.visiable=!1,this.search()},getStimulationSiteName:function(t){if(!t)return"-";var e=this.stimulationSiteOptions.find(function(e){return e.value===t});return e?e.label:"-"},getValidationMessage:function(t){try{var e=parseInt(t.presType),a={presType:e,presStrength:parseFloat(t.presStrength),presFreq:parseFloat(t.presFreq),lastTime:parseFloat(t.lastTime),pauseTime:parseInt(t.pauseTime),repeatCount:parseInt(t.repeatCount),periods:parseInt(t.periods)||1,totalCount:parseInt(t.totalCount),presPartName:this.getStimulationSiteName(t.presPartId)};1===e&&(a.tbsType=null!==t.tbsType&&void 0!==t.tbsType?parseInt(t.tbsType):null,a.innerFreq=null!==t.innerFreq&&void 0!==t.innerFreq?parseFloat(t.innerFreq):0,a.innerCount=null!==t.innerCount&&void 0!==t.innerCount?parseInt(t.innerCount):0,a.interFreq=null!==t.interFreq&&void 0!==t.interFreq?parseFloat(t.interFreq):0,a.interCount=null!==t.interCount&&void 0!==t.interCount?parseInt(t.interCount):0);var r=Object(g.d)(a,this.stimulationSiteOptions.map(function(t){return t.label}));return r.valid?null:r.message}catch(t){return"验证过程中出现错误"}},getCalculatedTotalCount:function(t){try{var e=parseInt(t.presType);if(0===e)return Object(g.a)(parseFloat(t.presFreq)||0,parseFloat(t.lastTime)||0,parseInt(t.repeatCount)||0);if(1===e){var a=parseInt(t.innerCount)||0,r=parseInt(t.interCount)||0,i=parseInt(t.periods)||1;return Object(g.b)(a,r,i)}return 0}catch(t){return 0}},calculateTotalCount:function(t){var e=this.getCalculatedTotalCount(t);e>0&&(t.totalCount=e)},onPresTypeChange:function(t,e){var a=this,r=parseInt(e);if(0===r)this.$set(t,"tbsType",null),this.$set(t,"innerFreq",null),this.$set(t,"innerCount",null),this.$set(t,"interFreq",null),this.$set(t,"interCount",null),this.$set(t,"periods",1);else if(1===r){this.$set(t,"tbsType",0);var i=Object(g.c)(0);l()(i).forEach(function(e){a.$set(t,e,i[e])})}this.autoCalculateTotalCount(t)},onTBSTypeChange:function(t,e){var a=this,r=Object(g.c)(parseInt(e));l()(r).forEach(function(e){a.$set(t,e,r[e])}),this.autoCalculateTotalCount(t)},autoCalculateTotalCount:function(t){var e=this.getCalculatedTotalCount(t);e>0&&this.$set(t,"totalCount",e)},handlePrescriptionDispatch:function(t){this.currentDispatchPrescription=t,this.patientSelectModal.visible=!0},handlePatientSelected:function(t){this.selectedPatient=t,this.patientSelectModal.visible=!1,this.currentDispatchPrescription.patientId=t.id,this.deviceSelectModal.visible=!0},handleDeviceSelected:function(t){var e=this;return n()(i.a.mark(function a(){var r,s,n,o,l;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e.selectedDevice=t,e.deviceSelectModal.visible=!1,a.prev=2,r={id:e.currentDispatchPrescription.id,patientId:e.selectedPatient.id,deviceId:t.deviceId,status:1,hospitalId:e.currentDispatchPrescription.hospitalId,doctorId:e.currentDispatchPrescription.doctorId,presType:e.currentDispatchPrescription.presType,presStrength:e.currentDispatchPrescription.presStrength,presFreq:e.currentDispatchPrescription.presFreq,lastTime:e.currentDispatchPrescription.lastTime,pauseTime:e.currentDispatchPrescription.pauseTime,repeatCount:e.currentDispatchPrescription.repeatCount,totalCount:e.currentDispatchPrescription.totalCount,totalTime:e.currentDispatchPrescription.totalTime,presPartId:e.currentDispatchPrescription.presPartId,presPartName:e.currentDispatchPrescription.presPartName,standardPresId:e.currentDispatchPrescription.standardPresId,standardPresName:e.currentDispatchPrescription.standardPresName,tbsType:e.currentDispatchPrescription.tbsType,innerFreq:e.currentDispatchPrescription.innerFreq,innerCount:e.currentDispatchPrescription.innerCount,interFreq:e.currentDispatchPrescription.interFreq,interCount:e.currentDispatchPrescription.interCount,periods:e.currentDispatchPrescription.periods,createdBy:e.currentDispatchPrescription.createdBy,updatedBy:e.currentDispatchPrescription.doctorId},a.next=6,e.$putJson("/prescription",r);case 6:return s={patientId:e.selectedPatient.id,deviceId:t.deviceId,prescriptionId:e.currentDispatchPrescription.id,status:0,progress:"处方已创建，等待下发"},a.next=9,e.$postJson("/prescription-execution",s);case 9:n=a.sent,(o=n.data||n)&&!0===o.success?(e.$message.success("处方下发成功！"),e.$router.push("/manage/prescriptionexecution").then(function(){window.location.reload()}).catch(function(t){e.$message.warning("跳转失败，请手动导航到处方执行页面")})):(l=o&&o.message?o.message:"未知错误",e.$message.error("处方下发失败："+l)),a.next=19;break;case 15:a.prev=15,a.t0=a.catch(2),e.$message.error("处方下发失败："+(a.t0.message||"网络错误"));case 19:e.currentDispatchPrescription=null,e.selectedPatient=null,e.selectedDevice=null;case 22:case"end":return a.stop()}},a,e,[[2,15]])}))()},handlePatientSelectCancel:function(){this.patientSelectModal.visible=!1,this.currentDispatchPrescription=null,this.selectedPatient=null},handleDeviceSelectCancel:function(){this.deviceSelectModal.visible=!1,this.currentDispatchPrescription=null,this.selectedPatient=null,this.selectedDevice=null}},mounted:function(){var t=this;return n()(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.d)(t);case 2:return e.next=4,Object(f.b)(t);case 4:t.stimulationSiteOptions=e.sent,t.search();case 7:case"end":return e.stop()}},e,t)}))()}},y={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-card",{staticClass:"card-area",attrs:{bordered:!1}},[a("div",{staticClass:"search"},[a("a-form",{attrs:{layout:"horizontal"}},[a("a-row",{attrs:{gutter:15}},[a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"患者ID",labelCol:{span:5},wrapperCol:{span:18,offset:1}}},[a("a-input",{model:{value:t.queryParams.patientId,callback:function(e){t.$set(t.queryParams,"patientId",e)},expression:"queryParams.patientId"}})],1)],1),t._v(" "),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"医院",labelCol:{span:5},wrapperCol:{span:18,offset:1}}},[a("a-select",{attrs:{placeholder:"请选择医院",allowClear:""},model:{value:t.queryParams.hospitalId,callback:function(e){t.$set(t.queryParams,"hospitalId",e)},expression:"queryParams.hospitalId"}},t._l(t.hospitalDict,function(e,r){return a("a-select-option",{key:r,attrs:{value:parseInt(r)}},[t._v(t._s(e))])}),1)],1)],1),t._v(" "),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"医生ID",labelCol:{span:5},wrapperCol:{span:18,offset:1}}},[a("a-input",{model:{value:t.queryParams.doctorId,callback:function(e){t.$set(t.queryParams,"doctorId",e)},expression:"queryParams.doctorId"}})],1)],1),t._v(" "),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"处方类型",labelCol:{span:5},wrapperCol:{span:18,offset:1}}},[a("a-select",{attrs:{placeholder:"请选择处方类型",allowClear:""},model:{value:t.queryParams.presType,callback:function(e){t.$set(t.queryParams,"presType",e)},expression:"queryParams.presType"}},[a("a-select-option",{attrs:{value:"0"}},[t._v("普通处方")]),t._v(" "),a("a-select-option",{attrs:{value:"1"}},[t._v("TBS处方")])],1)],1)],1),t._v(" "),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"状态",labelCol:{span:5},wrapperCol:{span:18,offset:1}}},[a("a-select",{attrs:{placeholder:"请选择状态",allowClear:""},model:{value:t.queryParams.status,callback:function(e){t.$set(t.queryParams,"status",e)},expression:"queryParams.status"}},[a("a-select-option",{attrs:{value:"0"}},[t._v("草稿")]),t._v(" "),a("a-select-option",{attrs:{value:"1"}},[t._v("已下发")]),t._v(" "),a("a-select-option",{attrs:{value:"2"}},[t._v("执行中")]),t._v(" "),a("a-select-option",{attrs:{value:"3"}},[t._v("完成")]),t._v(" "),a("a-select-option",{attrs:{value:"4"}},[t._v("异常")])],1)],1)],1),t._v(" "),a("a-col",{attrs:{md:8,sm:24}},[a("a-form-item",{attrs:{label:"治疗部位",labelCol:{span:5},wrapperCol:{span:18,offset:1}}},[a("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择治疗部位",allowClear:"",showSearch:""},model:{value:t.queryParams.presPartId,callback:function(e){t.$set(t.queryParams,"presPartId",e)},expression:"queryParams.presPartId"}},t._l(t.stimulationSiteOptions,function(e){return a("a-select-option",{key:e.value,attrs:{value:e.value}},[t._v("\n                ["+t._s(e.category)+"] "+t._s(e.label)+"\n              ")])}),1)],1)],1),t._v(" "),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"标准处方",labelCol:{span:5},wrapperCol:{span:18,offset:1}}},[a("a-input",{attrs:{placeholder:"请输入标准处方名称"},model:{value:t.queryParams.standardPresName,callback:function(e){t.$set(t.queryParams,"standardPresName",e)},expression:"queryParams.standardPresName"}})],1)],1),t._v(" "),a("span",{staticStyle:{float:"right","margin-top":"3px"}},[a("a-button",{attrs:{type:"primary"},on:{click:t.search}},[t._v("查询")]),t._v(" "),a("a-button",{staticStyle:{"margin-left":"8px"},on:{click:t.reset}},[t._v("重置")])],1)],1)],1)],1),t._v(" "),a("div",[a("div",{staticClass:"operator"},[a("a-button",{attrs:{type:"primary",ghost:""},on:{click:t.add}},[t._v("新增")]),t._v(" "),a("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"danger",ghost:""},on:{click:t.batchDelete}},[t._v("批量删除")]),t._v(" "),a("a-dropdown",{staticStyle:{"margin-left":"8px"}},[a("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[a("a-menu-item",{key:"export-data",on:{click:t.exportExcel}},[t._v("导出Excel")])],1),t._v(" "),a("a-button",[t._v("\n            更多操作 "),a("a-icon",{attrs:{type:"down"}})],1)],1)],1),t._v(" "),a("div",{staticStyle:{"margin-bottom":"16px",color:"#1890ff","font-size":"13px","font-weight":"500",background:"#f0f8ff",padding:"8px 12px","border-radius":"4px","border-left":"4px solid #1890ff"}},[a("a-icon",{staticStyle:{color:"#1890ff","margin-right":"6px"},attrs:{type:"info-circle"}}),t._v(" 点击表格中的 "),a("a-icon",{staticStyle:{color:"#1890ff"},attrs:{type:"down"}}),t._v(" 箭头图标可展开查看和编辑详细的处方参数\n      ")],1),t._v(" "),a("a-table",{attrs:{columns:t.columns,rowKey:function(t){return t.id},dataSource:t.dataSource,pagination:t.pagination,loading:t.loading,rowSelection:t.rowSelection,scroll:{x:1300}},on:{change:t.handleTableChange},scopedSlots:t._u([{key:"expand",fn:function(e,r){return[a("a-button",{staticStyle:{padding:"0",height:"auto","min-width":"auto"},attrs:{type:"link",size:"small",icon:r.expanded?"up":"down",title:r.expanded?"收起详情":"展开详情"},on:{click:function(e){return t.toggleExpand(r)}}})]}},{key:"operation",fn:function(e,r){return[a("a-icon",{staticStyle:{"margin-right":"8px"},attrs:{type:"eye",title:"详情"},on:{click:function(e){return t.handlePrescriptionViewOpen(r)}}}),t._v(" "),r.editing?a("a-icon",{staticStyle:{"margin-right":"8px"},attrs:{type:"save",title:"保存"},on:{click:function(e){return t.saveRow(r)}}}):t._e(),t._v(" "),r.editing?a("a-icon",{staticStyle:{"margin-right":"8px"},attrs:{type:"close",title:"取消"},on:{click:function(e){return t.cancelEdit(r)}}}):t._e(),t._v(" "),r.editing?t._e():a("a-icon",{staticStyle:{"margin-right":"8px"},attrs:{type:"edit",title:"编辑"},on:{click:function(e){return t.startEdit(r)}}}),t._v(" "),a("a-button",{staticStyle:{padding:"0",height:"auto",color:"#1890ff","margin-right":"8px"},attrs:{type:"link",size:"small",title:"下发"},on:{click:function(e){return t.handlePrescriptionDispatch(r)}}},[t._v("\n          下发\n        ")]),t._v(" "),a("a-icon",{attrs:{type:"delete",title:"删除"},on:{click:function(e){return t.remove(r)}}})]}},{key:"presType",fn:function(e,r){return[r.editing?a("a-select",{staticStyle:{width:"100%"},attrs:{size:"small"},on:{change:function(e){return t.onPresTypeChange(r,e)}},model:{value:r.presType,callback:function(e){t.$set(r,"presType",e)},expression:"record.presType"}},[a("a-select-option",{attrs:{value:"0"}},[t._v("普通处方")]),t._v(" "),a("a-select-option",{attrs:{value:"1"}},[t._v("TBS处方")])],1):0==e?a("a-tag",{attrs:{color:"blue"}},[t._v("普通处方")]):1==e?a("a-tag",{attrs:{color:"green"}},[t._v("TBS处方")]):a("span",[t._v(t._s(t.getPresTypeText(e)||e||"-"))])]}},{key:"status",fn:function(e,r){return[r.editing?a("a-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:r.status,callback:function(e){t.$set(r,"status",e)},expression:"record.status"}},[a("a-select-option",{attrs:{value:"0"}},[t._v("草稿")]),t._v(" "),a("a-select-option",{attrs:{value:"1"}},[t._v("已下发")]),t._v(" "),a("a-select-option",{attrs:{value:"2"}},[t._v("执行中")]),t._v(" "),a("a-select-option",{attrs:{value:"3"}},[t._v("完成")]),t._v(" "),a("a-select-option",{attrs:{value:"4"}},[t._v("异常")])],1):0==e?a("a-tag",{staticStyle:{"border-color":"#d9d9d9",color:"#666"},attrs:{color:"dashed"}},[t._v("草稿")]):1==e?a("a-tag",{attrs:{color:"blue"}},[t._v("已下发")]):2==e?a("a-tag",{attrs:{color:"orange"}},[t._v("执行中")]):3==e?a("a-tag",{attrs:{color:"green"}},[t._v("完成")]):4==e?a("a-tag",{attrs:{color:"red"}},[t._v("异常")]):a("span",[t._v(t._s(t.getStatusText(e)||e||"-"))])]}},{key:"tbsType",fn:function(e,r){return[r.editing?a("a-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:r.tbsType,callback:function(e){t.$set(r,"tbsType",e)},expression:"record.tbsType"}},[a("a-select-option",{attrs:{value:"0"}},[t._v("iTBS")]),t._v(" "),a("a-select-option",{attrs:{value:"1"}},[t._v("cTBS")])],1):0==e?a("a-tag",{attrs:{color:"purple"}},[t._v("iTBS")]):1==e?a("a-tag",{attrs:{color:"cyan"}},[t._v("cTBS")]):a("span",[t._v(t._s(e||"-"))])]}},{key:"patientId",fn:function(e,r){return[r.editing?a("a-input",{attrs:{size:"small"},model:{value:r.patientId,callback:function(e){t.$set(r,"patientId",e)},expression:"record.patientId"}}):a("span",[t._v(t._s(e))])]}},{key:"hospitalId",fn:function(e,r){return[r.editing?a("a-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:r.hospitalId,callback:function(e){t.$set(r,"hospitalId",e)},expression:"record.hospitalId"}},t._l(t.hospitalDict,function(e,r){return a("a-select-option",{key:r,attrs:{value:parseInt(r)}},[t._v(t._s(e))])}),1):a("span",[t._v(t._s(t.getHospitalName(e)))])]}},{key:"doctorId",fn:function(e,r){return[r.editing?a("a-input",{attrs:{size:"small"},model:{value:r.doctorId,callback:function(e){t.$set(r,"doctorId",e)},expression:"record.doctorId"}}):a("span",[t._v(t._s(e))])]}},{key:"presPartName",fn:function(e,r){return[r.editing?a("a-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:r.presPartId,callback:function(e){t.$set(r,"presPartId",e)},expression:"record.presPartId"}},t._l(t.stimulationSiteOptions,function(e){return a("a-select-option",{key:e.value,attrs:{value:e.value}},[t._v("\n            ["+t._s(e.category)+"] "+t._s(e.label)+"\n          ")])}),1):a("span",[t._v(t._s(t.getStimulationSiteName(r.presPartId)))])]}},{key:"standardPresName",fn:function(e,r){return[r.editing?a("a-input",{attrs:{size:"small"},model:{value:r.standardPresName,callback:function(e){t.$set(r,"standardPresName",e)},expression:"record.standardPresName"}}):a("span",[t._v(t._s(e||"-"))])]}}])}),t._v(" "),t._l(t.dataSource,function(e){return e.expanded?a("div",{key:e.id,staticClass:"expanded-detail"},[a("div",{staticClass:"expanded-row"},[a("div",{staticClass:"expanded-header"},[a("h3",[t._v("详细参数")]),t._v(" "),a("div",{staticClass:"expanded-actions"},[e.editing?t._e():a("a-button",{attrs:{type:"primary",size:"small",icon:"edit"},on:{click:function(a){return t.startEdit(e)}}},[t._v("\n              编辑\n            ")]),t._v(" "),e.editing?a("a-button",{attrs:{type:"primary",size:"small",icon:"save",loading:t.loading},on:{click:function(a){return t.saveRow(e)}}},[t._v("\n              保存\n            ")]):t._e(),t._v(" "),e.editing?a("a-button",{attrs:{size:"small",icon:"close"},on:{click:function(a){return t.cancelEdit(e)}}},[t._v("\n              取消\n            ")]):t._e()],1)]),t._v(" "),e.editing?a("div",{staticClass:"validation-area",staticStyle:{"margin-bottom":"16px",padding:"12px",background:"#f6ffed",border:"1px solid #b7eb8f","border-radius":"4px"}},[a("h4",{staticStyle:{margin:"0 0 8px 0",color:"#52c41a"}},[t._v("参数验证")]),t._v(" "),t.getValidationMessage(e)?a("div",{staticStyle:{color:"#ff4d4f","font-size":"12px"}},[a("a-icon",{attrs:{type:"warning"}}),t._v(" "+t._s(t.getValidationMessage(e))+"\n          ")],1):a("div",{staticStyle:{color:"#52c41a","font-size":"12px"}},[a("a-icon",{attrs:{type:"check-circle"}}),t._v(" 参数验证通过\n          ")],1)]):t._e(),t._v(" "),a("a-row",{attrs:{gutter:16}},[a("a-col",{attrs:{span:8}},[a("h4",[t._v("处方参数")]),t._v(" "),a("div",{staticClass:"param-item"},[a("label",[t._v("刺激强度：")]),t._v(" "),e.editing?a("a-input-number",{staticStyle:{width:"100%"},attrs:{size:"small",min:0,max:100},model:{value:e.presStrength,callback:function(a){t.$set(e,"presStrength",a)},expression:"record.presStrength"}}):a("span",[t._v(t._s(e.presStrength)+"%")])],1),t._v(" "),a("div",{staticClass:"param-item"},[a("label",[t._v("刺激频率：")]),t._v(" "),e.editing?a("a-input-number",{staticStyle:{width:"100%"},attrs:{size:"small",min:0,max:50,step:.1},on:{change:function(a){return t.autoCalculateTotalCount(e)}},model:{value:e.presFreq,callback:function(a){t.$set(e,"presFreq",a)},expression:"record.presFreq"}}):a("span",[t._v(t._s(e.presFreq)+"Hz")])],1),t._v(" "),a("div",{staticClass:"param-item"},[a("label",[t._v("刺激时间：")]),t._v(" "),e.editing?a("a-input-number",{staticStyle:{width:"100%"},attrs:{size:"small",min:0,max:60,step:.1},on:{change:function(a){return t.autoCalculateTotalCount(e)}},model:{value:e.lastTime,callback:function(a){t.$set(e,"lastTime",a)},expression:"record.lastTime"}}):a("span",[t._v(t._s(e.lastTime)+" 秒")])],1),t._v(" "),a("div",{staticClass:"param-item"},[a("label",[t._v("间歇时间：")]),t._v(" "),e.editing?a("a-input-number",{staticStyle:{width:"100%"},attrs:{size:"small",min:0,max:300},model:{value:e.pauseTime,callback:function(a){t.$set(e,"pauseTime",a)},expression:"record.pauseTime"}}):a("span",[t._v(t._s(e.pauseTime)+" 秒")])],1)]),t._v(" "),a("a-col",{attrs:{span:8}},[a("h4",[t._v("执行参数")]),t._v(" "),a("div",{staticClass:"param-item"},[a("label",[t._v("重复次数：")]),t._v(" "),e.editing?a("a-input-number",{staticStyle:{width:"100%"},attrs:{size:"small",min:0,max:1e3},on:{change:function(a){return t.autoCalculateTotalCount(e)}},model:{value:e.repeatCount,callback:function(a){t.$set(e,"repeatCount",a)},expression:"record.repeatCount"}}):a("span",[t._v(t._s(e.repeatCount)+"次")])],1),t._v(" "),a("div",{staticClass:"param-item"},[a("label",[t._v("周期数：")]),t._v(" "),e.editing?a("a-input-number",{staticStyle:{width:"100%"},attrs:{size:"small",min:1,max:1e3},on:{change:function(a){return t.autoCalculateTotalCount(e)}},model:{value:e.periods,callback:function(a){t.$set(e,"periods",a)},expression:"record.periods"}}):a("span",[t._v(t._s(e.periods||1)+"个")])],1),t._v(" "),a("div",{staticClass:"param-item"},[a("label",[t._v("总脉冲数：")]),t._v(" "),e.editing?a("a-input-number",{staticStyle:{width:"100%"},attrs:{size:"small",min:0,max:1e4},on:{change:function(a){return t.calculateTotalCount(e)}},model:{value:e.totalCount,callback:function(a){t.$set(e,"totalCount",a)},expression:"record.totalCount"}}):a("span",[t._v(t._s(e.totalCount)+"个")]),t._v(" "),e.editing?a("div",{staticStyle:{"font-size":"11px",color:"#666","margin-top":"2px"}},[a("a-icon",{attrs:{type:"calculator"}}),t._v(" 自动计算值\n              ")],1):t._e()],1),t._v(" "),a("div",{staticClass:"param-item"},[a("label",[t._v("总时间：")]),t._v(" "),e.editing?a("a-input-number",{staticStyle:{width:"100%"},attrs:{size:"small",min:0,max:7200},model:{value:e.totalTime,callback:function(a){t.$set(e,"totalTime",a)},expression:"record.totalTime"}}):a("span",[t._v(t._s(e.totalTime)+" 秒")])],1),t._v(" "),a("div",{staticClass:"param-item"},[a("label",[t._v("标准处方：")]),t._v(" "),e.editing?a("div",{staticStyle:{display:"flex","align-items":"center",width:"100%"}},[a("a-input",{staticStyle:{cursor:"pointer",flex:"1","margin-right":"8px"},attrs:{size:"small",placeholder:"点击选择标准处方",readonly:""},on:{click:function(a){return t.showStandardPrescriptionModalForRow(e)}},model:{value:e.standardPresName,callback:function(a){t.$set(e,"standardPresName",a)},expression:"record.standardPresName"}}),t._v(" "),a("a-button",{attrs:{type:"primary",size:"small",icon:"search"},on:{click:function(a){return t.showStandardPrescriptionModalForRow(e)}}},[t._v("\n                  选择\n                ")])],1):a("span",[t._v(t._s(e.standardPresName||"-"))])])]),t._v(" "),1===parseInt(e.presType)?a("a-col",{attrs:{span:8}},[a("h4",[t._v("TBS参数")]),t._v(" "),a("div",{staticClass:"param-item"},[a("label",[t._v("TBS类型：")]),t._v(" "),e.editing?a("a-select",{staticStyle:{width:"100%"},attrs:{size:"small"},on:{change:function(a){return t.onTBSTypeChange(e,a)}},model:{value:e.tbsType,callback:function(a){t.$set(e,"tbsType",a)},expression:"record.tbsType"}},[a("a-select-option",{attrs:{value:"0"}},[t._v("iTBS")]),t._v(" "),a("a-select-option",{attrs:{value:"1"}},[t._v("cTBS")])],1):a("span",[t._v("\n                "+t._s(0==e.tbsType?"iTBS":1==e.tbsType?"cTBS":"-")+"\n              ")])],1),t._v(" "),a("div",{staticClass:"param-item"},[a("label",[t._v("丛内频率：")]),t._v(" "),e.editing?a("a-input-number",{staticStyle:{width:"100%"},attrs:{size:"small",min:.1,max:200,step:.1,disabled:""},model:{value:e.innerFreq,callback:function(a){t.$set(e,"innerFreq",a)},expression:"record.innerFreq"}}):a("span",[t._v(t._s(e.innerFreq||"-")+"Hz")])],1),t._v(" "),a("div",{staticClass:"param-item"},[a("label",[t._v("丛内个数：")]),t._v(" "),e.editing?a("a-input-number",{staticStyle:{width:"100%"},attrs:{size:"small",min:1,max:200,disabled:""},model:{value:e.innerCount,callback:function(a){t.$set(e,"innerCount",a)},expression:"record.innerCount"}}):a("span",[t._v(t._s(e.innerCount||"-")+"个")])],1),t._v(" "),a("div",{staticClass:"param-item"},[a("label",[t._v("丛间频率：")]),t._v(" "),e.editing?a("a-input-number",{staticStyle:{width:"100%"},attrs:{size:"small",min:.1,max:200,step:.1,disabled:""},model:{value:e.interFreq,callback:function(a){t.$set(e,"interFreq",a)},expression:"record.interFreq"}}):a("span",[t._v(t._s(e.interFreq||"-")+"Hz")])],1),t._v(" "),a("div",{staticClass:"param-item"},[a("label",[t._v("丛间个数：")]),t._v(" "),e.editing?a("a-input-number",{staticStyle:{width:"100%"},attrs:{size:"small",min:1,max:200,disabled:""},model:{value:e.interCount,callback:function(a){t.$set(e,"interCount",a)},expression:"record.interCount"}}):a("span",[t._v(t._s(e.interCount||"-")+"个")])],1)]):t._e()],1)],1)]):t._e()})],2),t._v(" "),t.prescriptionAdd.visiable?a("prescription-add",{ref:"prescriptionAdd",attrs:{prescriptionAddVisiable:t.prescriptionAdd.visiable},on:{close:t.handlePrescriptionAddClose,success:t.handlePrescriptionAddSuccess,openStandardPrescriptionModal:t.handleOpenStandardPrescriptionModal}}):t._e(),t._v(" "),a("standard-prescription-modal",{attrs:{visible:t.standardPrescriptionModal.visible},on:{"update:visible":function(e){return t.$set(t.standardPrescriptionModal,"visible",e)},standardPrescriptionSelected:t.handleStandardPrescriptionSelected}}),t._v(" "),a("prescription-view",{attrs:{prescriptionShow:t.prescriptionView.visiable,prescriptionData:t.prescriptionView.data},on:{close:t.handlePrescriptionViewClose}}),t._v(" "),t.prescriptionEdit.visiable?a("prescription-edit",{ref:"prescriptionEdit",attrs:{prescriptionEditVisiable:t.prescriptionEdit.visiable},on:{close:t.handlePrescriptionEditClose,success:t.handlePrescriptionEditSuccess,openStandardPrescriptionModal:t.handleOpenStandardPrescriptionModal}}):t._e(),t._v(" "),a("patient-select-modal",{attrs:{visible:t.patientSelectModal.visible},on:{patientSelected:t.handlePatientSelected,cancel:t.handlePatientSelectCancel}}),t._v(" "),a("device-select-modal",{attrs:{visible:t.deviceSelectModal.visible},on:{deviceSelected:t.handleDeviceSelected,cancel:t.handleDeviceSelectCancel}})],1)},staticRenderFns:[]},S=a("VU/8")(b,y,!1,function(t){a("eiU3")},"data-v-8a7e158e",null);e.default=S.exports},eKKA:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("Dd8w"),i=a.n(r),s=a("Xxa5"),n=a.n(s),o=a("exGp"),l=a.n(o),c=a("Mqi+"),d=a("jmyz"),p={name:"PrescriptionAdd",props:{prescriptionAddVisiable:{default:!1}},computed:{show:{get:function(){return this.prescriptionAddVisiable},set:function(){}}},data:function(){return{form:this.$form.createForm(this),loading:!1,selectedStandardPrescriptionName:"",stimulationSiteOptions:[],isTBSMode:!1}},mounted:function(){var t=this;return l()(n.a.mark(function e(){return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(c.b)(t);case 2:t.stimulationSiteOptions=e.sent,t.$nextTick(function(){t.setupFormWatchers()});case 4:case"end":return e.stop()}},e,t)}))()},methods:{reset:function(){this.loading=!1,this.form.resetFields(),this.selectedStandardPrescriptionName="",this.formWatcher&&(clearInterval(this.formWatcher),this.formWatcher=null)},onClose:function(){this.reset(),this.$emit("close")},beforeDestroy:function(){this.formWatcher&&(clearInterval(this.formWatcher),this.formWatcher=null)},handleSubmit:function(){var t=this;this.form.validateFields(function(e,a){if(!e){var r=i()({},a,{presType:parseInt(a.presType),presStrength:parseFloat(a.presStrength),presFreq:parseFloat(a.presFreq),lastTime:parseFloat(a.lastTime),pauseTime:parseInt(a.pauseTime),repeatCount:parseInt(a.repeatCount),totalCount:parseInt(a.totalCount),totalTime:parseInt(a.totalTime),tbsType:null!==a.tbsType&&void 0!==a.tbsType?parseInt(a.tbsType):null,innerPulseCount:null!==a.innerPulseCount&&void 0!==a.innerPulseCount?parseInt(a.innerPulseCount):null,outerFreq:null!==a.outerFreq&&void 0!==a.outerFreq?parseFloat(a.outerFreq):null,status:parseInt(a.status)}),s=t.stimulationSiteOptions.find(function(t){return t.value===r.presPartId});r.presPartName=s?s.label:"";var n=Object(d.d)(r,t.stimulationSiteOptions.map(function(t){return t.label}));if(!n.valid)return void t.$message.error(n.message);t.loading=!0,t.$postJson("/prescription",r).then(function(){t.reset(),t.$emit("success")}).catch(function(){t.loading=!1})}})},showStandardPrescriptionModal:function(){this.$emit("openStandardPrescriptionModal")},applyStandardPrescription:function(t){this.selectedStandardPrescriptionName=t.indication1+" - "+t.indication2;var e={presFreq:t.presFreq,lastTime:t.lastTime,pauseTime:t.pauseTime,repeatCount:t.repeatCount,totalTime:60*t.totalTime,presPartId:this.getSiteIdByName(t.presPart),presPartName:t.presPart,standardPresName:this.selectedStandardPrescriptionName};this.form.setFieldsValue(e),this.$message.success("标准处方参数已自动填充")},getSiteIdByName:function(t){var e=this.stimulationSiteOptions.find(function(e){return e.label===t});return e?e.value:null},setupFormWatchers:function(){var t=this;this.formWatcher=setInterval(function(){t.autoCalculateTotalCount()},500)},onPresTypeChange:function(t){var e=parseInt(t);if(this.isTBSMode=1===e,0===e)this.form.setFieldsValue({tbsType:null,innerFreq:null,innerCount:null,interFreq:null,interCount:null});else if(1===e){this.form.setFieldsValue({tbsType:0});var a=Object(d.c)(0);this.form.setFieldsValue(a)}this.autoCalculateTotalCount()},onTBSTypeChange:function(t){var e=Object(d.c)(parseInt(t));this.form.setFieldsValue(e),this.autoCalculateTotalCount()},autoCalculateTotalCount:function(){var t=this.form.getFieldsValue(),e=parseInt(t.presType);if(0===e){var a=Object(d.a)(parseFloat(t.presFreq)||0,parseFloat(t.lastTime)||0,parseInt(t.repeatCount)||0);a>0&&this.form.setFieldsValue({totalCount:a})}else if(1===e){var r=Object(d.b)(parseInt(t.innerCount)||0,parseInt(t.interCount)||0,parseInt(t.periods)||1);r>0&&this.form.setFieldsValue({totalCount:r})}}}},u={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-modal",{attrs:{title:"新增处方",width:900},on:{cancel:t.onClose},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[a("template",{slot:"footer"},[a("a-button",{key:"back",on:{click:t.onClose}},[t._v("取消")]),t._v(" "),a("a-button",{key:"submit",attrs:{type:"primary",loading:t.loading},on:{click:t.handleSubmit}},[t._v("提交")])],1),t._v(" "),a("a-form",{attrs:{form:t.form,layout:"vertical"}},[a("a-row",{attrs:{gutter:20}},[a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"患者ID"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["patientId",{rules:[{required:!0,message:"请输入患者ID!"}]}],expression:"['patientId', { rules: [{ required: true, message: '请输入患者ID!' }] }]"}]})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"医院ID"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["hospitalId",{rules:[{required:!0,message:"请输入医院ID!"}]}],expression:"['hospitalId', { rules: [{ required: true, message: '请输入医院ID!' }] }]"}]})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"医生ID"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["doctorId",{rules:[{required:!0,message:"请输入医生ID!"}]}],expression:"['doctorId', { rules: [{ required: true, message: '请输入医生ID!' }] }]"}]})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"处方类型"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["presType",{initialValue:0,rules:[{required:!0,message:"请选择处方类型!"}]}],expression:"['presType', { initialValue: 0, rules: [{ required: true, message: '请选择处方类型!' }] }]"}],on:{change:t.onPresTypeChange}},[a("a-select-option",{attrs:{value:"0"}},[t._v("普通处方")]),t._v(" "),a("a-select-option",{attrs:{value:"1"}},[t._v("TBS处方")])],1)],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"刺激强度(%)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["presStrength",{initialValue:80,rules:[{required:!0,message:"请输入刺激强度!"}]}],expression:"['presStrength', { initialValue: 80, rules: [{ required: true, message: '请输入刺激强度!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:100}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"刺激频率(Hz)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["presFreq",{initialValue:10,rules:[{required:!0,message:"请输入刺激频率!"}]}],expression:"['presFreq', { initialValue: 10.0, rules: [{ required: true, message: '请输入刺激频率!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:50,step:.1}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"刺激时间(秒)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["lastTime",{initialValue:5,rules:[{required:!0,message:"请输入刺激时间!"}]}],expression:"['lastTime', { initialValue: 5.0, rules: [{ required: true, message: '请输入刺激时间!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:60,step:.1}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"间歇时间(秒)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["pauseTime",{initialValue:25,rules:[{required:!0,message:"请输入间歇时间!"}]}],expression:"['pauseTime', { initialValue: 25, rules: [{ required: true, message: '请输入间歇时间!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:300}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"重复次数(次)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["repeatCount",{initialValue:40,rules:[{required:!0,message:"请输入重复次数!"}]}],expression:"['repeatCount', { initialValue: 40, rules: [{ required: true, message: '请输入重复次数!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:1e3}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"周期数(个)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["periods",{initialValue:1,rules:[{required:!0,message:"请输入周期数!"}]}],expression:"['periods', { initialValue: 1, rules: [{ required: true, message: '请输入周期数!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:1,max:1e3}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"总脉冲数(个)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["totalCount",{initialValue:200,rules:[{required:!0,message:"请输入总脉冲数!"}]}],expression:"['totalCount', { initialValue: 200, rules: [{ required: true, message: '请输入总脉冲数!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:1e4}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"总时间(秒)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["totalTime",{initialValue:1200,rules:[{required:!0,message:"请输入总时间!"}]}],expression:"['totalTime', { initialValue: 1200, rules: [{ required: true, message: '请输入总时间!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:7200}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"治疗部位"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["presPartId",{rules:[{required:!0,message:"请选择治疗部位!"}]}],expression:"['presPartId', { rules: [{ required: true, message: '请选择治疗部位!' }] }]"}],attrs:{placeholder:"请选择治疗部位"}},t._l(t.stimulationSiteOptions,function(e){return a("a-select-option",{key:e.value,attrs:{value:e.value}},[t._v("\n            ["+t._s(e.category)+"] "+t._s(e.label)+"\n          ")])}),1)],1)],1),t._v(" "),a("a-col",{attrs:{md:12,sm:24}},[a("a-form-item",{attrs:{label:"标准处方",labelCol:{span:6},wrapperCol:{span:17}}},[a("a-row",{attrs:{gutter:16}},[a("a-col",{attrs:{span:16}},[a("a-input",{staticStyle:{cursor:"pointer"},attrs:{placeholder:"点击选择标准处方",readonly:""},on:{click:t.showStandardPrescriptionModal},model:{value:t.selectedStandardPrescriptionName,callback:function(e){t.selectedStandardPrescriptionName=e},expression:"selectedStandardPrescriptionName"}})],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-button",{attrs:{type:"primary",icon:"search"},on:{click:t.showStandardPrescriptionModal}},[t._v("\n                  选择标准处方\n                ")])],1)],1)],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"TBS类型"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["tbsType",{initialValue:null}],expression:"['tbsType', { initialValue: null }]"}],attrs:{disabled:!t.isTBSMode},on:{change:t.onTBSTypeChange}},[a("a-select-option",{attrs:{value:"0"}},[t._v("iTBS")]),t._v(" "),a("a-select-option",{attrs:{value:"1"}},[t._v("cTBS")])],1)],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"丛内频率(Hz)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["innerFreq",{initialValue:null}],expression:"['innerFreq', { initialValue: null }]"}],staticStyle:{width:"100%"},attrs:{min:.1,max:200,step:.1,disabled:""}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"丛内个数(个)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["innerCount",{initialValue:null}],expression:"['innerCount', { initialValue: null }]"}],staticStyle:{width:"100%"},attrs:{min:1,max:200,disabled:""}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"丛间频率(Hz)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["interFreq",{initialValue:null}],expression:"['interFreq', { initialValue: null }]"}],staticStyle:{width:"100%"},attrs:{min:.1,max:200,step:.1,disabled:""}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"丛间个数(个)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["interCount",{initialValue:null}],expression:"['interCount', { initialValue: null }]"}],staticStyle:{width:"100%"},attrs:{min:1,max:200,disabled:""}})],1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-form-item",{attrs:{label:"状态"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["status",{initialValue:0}],expression:"['status', { initialValue: 0 }]"}]},[a("a-select-option",{attrs:{value:"0"}},[t._v("草稿")]),t._v(" "),a("a-select-option",{attrs:{value:"1"}},[t._v("已下发")]),t._v(" "),a("a-select-option",{attrs:{value:"2"}},[t._v("执行中")]),t._v(" "),a("a-select-option",{attrs:{value:"3"}},[t._v("完成")]),t._v(" "),a("a-select-option",{attrs:{value:"4"}},[t._v("异常")])],1)],1)],1)],1)],1)],2)},staticRenderFns:[]},v=a("VU/8")(p,u,!1,function(t){a("8v8l")},"data-v-cc24a788",null);e.default=v.exports},eiU3:function(t,e){},krl9:function(t,e){},"w/5g":function(t,e){},wMQb:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("c/Tr"),i=a.n(r),s=a("lHA8"),n=a.n(s),o=a("Xxa5"),l=a.n(o),c=a("exGp"),d=a.n(c),p={name:"StandardPrescriptionModal",props:{visible:{type:Boolean,default:!1}},data:function(){return{searchKeyword:"",filterIndication1:"",filterIndication2:"",filterPresPart:"",sortBy:"standard_pres_id",selectedStandardId:null,selectedStandardPrescription:null,standardPrescriptions:[],loading:!1,indication1Options:[],indication2Options:[],presPartOptions:[]}},computed:{filteredStandardPrescriptions:function(){var t=this,e=this.standardPrescriptions.filter(function(e){if(t.searchKeyword){var a=t.searchKeyword.toLowerCase();if(!((e.indication1||"")+" "+(e.indication2||"")+" "+(e.indication3||"")+" "+(e.indicationKeyword||"")+" "+(e.presPart||"")).toLowerCase().includes(a))return!1}return!(t.filterIndication1&&e.indication1!==t.filterIndication1||t.filterIndication2&&e.indication2!==t.filterIndication2||t.filterPresPart&&e.presPart!==t.filterPresPart)});return e.sort(function(e,a){return"standard_pres_id"===t.sortBy?(e.standardPresId||0)-(a.standardPresId||0):"pres_part"===t.sortBy?(e.presPart||"").localeCompare(a.presPart||""):(e[t.sortBy]||"").localeCompare(a[t.sortBy]||"")}),e}},watch:{visible:function(t){t&&this.loadStandardPrescriptions()}},methods:{loadStandardPrescriptions:function(){var t=this;return d()(l.a.mark(function e(){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.prev=1,e.next=4,t.$get("/standard-prescription/list");case 4:(a=e.sent)&&Array.isArray(a)?t.standardPrescriptions=a:a&&a.data&&Array.isArray(a.data)?t.standardPrescriptions=a.data:a&&a.result&&Array.isArray(a.result)?t.standardPrescriptions=a.result:a&&a.content&&Array.isArray(a.content)?t.standardPrescriptions=a.content:a&&a.data&&a.data.data&&Array.isArray(a.data.data)?t.standardPrescriptions=a.data.data:(t.$message.error("标准处方数据格式异常"),t.standardPrescriptions=[]),t.extractFilterOptions(),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(1),t.$message.error("加载标准处方失败: "+e.t0.message),t.standardPrescriptions=[];case 16:return e.prev=16,t.loading=!1,e.finish(16);case 19:case"end":return e.stop()}},e,t,[[1,11,16,19]])}))()},extractFilterOptions:function(){var t=new n.a,e=new n.a,a=new n.a;this.standardPrescriptions.forEach(function(r,i){r.indication1&&t.add(r.indication1),r.indication2&&e.add(r.indication2),r.presPart&&a.add(r.presPart)}),this.indication1Options=i()(t).sort(),this.indication2Options=i()(e).sort(),this.presPartOptions=i()(a).sort()},selectStandardPrescription:function(t){this.selectedStandardId=t.standardPresId,this.selectedStandardPrescription=t},applySelectedStandardPrescription:function(){this.selectedStandardPrescription?(this.$emit("standardPrescriptionSelected",this.selectedStandardPrescription),this.onCancel()):this.$message.warning("请先选择一个标准处方")},onSearch:function(){},onFilterChange:function(){},onSortChange:function(){},onCancel:function(){this.selectedStandardId=null,this.selectedStandardPrescription=null,this.searchKeyword="",this.filterIndication1="",this.filterIndication2="",this.filterPresPart="",this.$emit("update:visible",!1)}}},u={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-modal",{attrs:{title:"选择标准处方",width:"1200px",footer:null},on:{cancel:t.onCancel},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[a("div",{staticClass:"search-section",staticStyle:{"margin-bottom":"20px"}},[a("a-row",{attrs:{gutter:16}},[a("a-col",{attrs:{span:6}},[a("a-input-search",{attrs:{placeholder:"搜索适应症或关键词",allowClear:""},on:{search:t.onSearch},model:{value:t.searchKeyword,callback:function(e){t.searchKeyword=e},expression:"searchKeyword"}})],1),t._v(" "),a("a-col",{attrs:{span:4}},[a("a-select",{attrs:{placeholder:"适应症分类",allowClear:""},on:{change:t.onFilterChange},model:{value:t.filterIndication1,callback:function(e){t.filterIndication1=e},expression:"filterIndication1"}},t._l(t.indication1Options,function(e){return a("a-select-option",{key:e,attrs:{value:e}},[t._v("\n            "+t._s(e)+"\n          ")])}),1)],1),t._v(" "),a("a-col",{attrs:{span:4}},[a("a-select",{attrs:{placeholder:"具体疾病",allowClear:""},on:{change:t.onFilterChange},model:{value:t.filterIndication2,callback:function(e){t.filterIndication2=e},expression:"filterIndication2"}},t._l(t.indication2Options,function(e){return a("a-select-option",{key:e,attrs:{value:e}},[t._v("\n            "+t._s(e)+"\n          ")])}),1)],1),t._v(" "),a("a-col",{attrs:{span:4}},[a("a-select",{attrs:{placeholder:"治疗部位",allowClear:""},on:{change:t.onFilterChange},model:{value:t.filterPresPart,callback:function(e){t.filterPresPart=e},expression:"filterPresPart"}},t._l(t.presPartOptions,function(e){return a("a-select-option",{key:e,attrs:{value:e}},[t._v("\n            "+t._s(e)+"\n          ")])}),1)],1),t._v(" "),a("a-col",{attrs:{span:6}},[a("a-select",{attrs:{placeholder:"排序方式"},on:{change:t.onSortChange},model:{value:t.sortBy,callback:function(e){t.sortBy=e},expression:"sortBy"}},[a("a-select-option",{attrs:{value:"standard_pres_id"}},[t._v("默认排序")]),t._v(" "),a("a-select-option",{attrs:{value:"indication1"}},[t._v("适应症分类")]),t._v(" "),a("a-select-option",{attrs:{value:"pres_part"}},[t._v("治疗部位")]),t._v(" "),a("a-select-option",{attrs:{value:"evidence_level"}},[t._v("证据等级")])],1)],1)],1)],1),t._v(" "),a("div",{staticClass:"prescription-grid",staticStyle:{"max-height":"500px","overflow-y":"auto"}},[t.loading?a("div",{staticStyle:{"text-align":"center",padding:"40px"}},[a("a-spin",{attrs:{size:"large"}}),t._v(" "),a("p",{staticStyle:{"margin-top":"16px",color:"#666"}},[t._v("正在加载标准处方数据...")])],1):0===t.filteredStandardPrescriptions.length?a("div",{staticStyle:{"text-align":"center",padding:"40px"}},[a("a-empty",{attrs:{description:"暂无标准处方数据"}})],1):a("a-row",{attrs:{gutter:16}},t._l(t.filteredStandardPrescriptions,function(e){return a("a-col",{key:e.standardPresId,staticStyle:{"margin-bottom":"16px"},attrs:{span:12}},[a("a-card",{staticClass:"prescription-item",class:{selected:t.selectedStandardId===e.standardPresId},attrs:{hoverable:"",size:"small"},on:{click:function(a){return t.selectStandardPrescription(e)}}},[a("div",{staticClass:"prescription-header"},[a("h4",{staticStyle:{margin:"0 0 8px 0",color:"#1890ff"}},[t._v("\n              "+t._s(e.indication1)+" - "+t._s(e.indication2)+"\n            ")]),t._v(" "),a("div",{staticStyle:{"margin-bottom":"8px"}},[e.indication3?a("a-tag",{attrs:{color:"blue",size:"small"}},[t._v(t._s(e.indication3))]):t._e(),t._v(" "),1===e.builtIn?a("a-tag",{attrs:{color:"green",size:"small"}},[t._v("系统内置")]):a("a-tag",{attrs:{color:"orange",size:"small"}},[t._v("用户自定义")])],1)]),t._v(" "),a("div",{staticClass:"prescription-content"},[a("div",{staticClass:"indication-info",staticStyle:{"margin-bottom":"12px"}},[a("p",{staticStyle:{margin:"0",color:"#666","font-size":"12px"}},[a("strong",[t._v("适应症：")]),t._v(t._s(e.indication1)+" > "+t._s(e.indication2)+"\n                "),e.indication3?a("span",[t._v(" > "+t._s(e.indication3))]):t._e()]),t._v(" "),e.indication_keyword?a("p",{staticStyle:{margin:"4px 0 0 0",color:"#999","font-size":"11px"}},[a("strong",[t._v("关键词：")]),t._v(t._s(e.indication_keyword)+"\n              ")]):t._e()]),t._v(" "),a("div",{staticClass:"params-grid",staticStyle:{"margin-bottom":"12px"}},[a("a-row",{attrs:{gutter:8}},[a("a-col",{attrs:{span:12}},[a("div",{staticClass:"param-item"},[a("label",[t._v("刺激频率:")]),t._v(" "),a("span",[t._v(t._s(e.presFreq)+"Hz")])])]),t._v(" "),a("a-col",{attrs:{span:12}},[a("div",{staticClass:"param-item"},[a("label",[t._v("持续时间:")]),t._v(" "),a("span",[t._v(t._s(e.lastTime)+"秒")])])]),t._v(" "),a("a-col",{attrs:{span:12}},[a("div",{staticClass:"param-item"},[a("label",[t._v("脉冲数量:")]),t._v(" "),a("span",[t._v(t._s(e.lastCount))])])]),t._v(" "),a("a-col",{attrs:{span:12}},[a("div",{staticClass:"param-item"},[a("label",[t._v("间歇时间:")]),t._v(" "),a("span",[t._v(t._s(e.pauseTime)+"秒")])])]),t._v(" "),a("a-col",{attrs:{span:12}},[a("div",{staticClass:"param-item"},[a("label",[t._v("重复次数:")]),t._v(" "),a("span",[t._v(t._s(e.repeatCount))])])]),t._v(" "),a("a-col",{attrs:{span:12}},[a("div",{staticClass:"param-item"},[a("label",[t._v("总时间:")]),t._v(" "),a("span",[t._v(t._s(e.totalTime)+"分钟")])])])],1)],1),t._v(" "),a("div",{staticClass:"treatment-info",staticStyle:{"margin-bottom":"8px"}},[a("a-tag",{attrs:{color:"purple",size:"small"}},[t._v(t._s(e.presPart))])],1),t._v(" "),a("div",{staticClass:"evidence-info",staticStyle:{"font-size":"11px",color:"#999"}},[e.evidenceLevel?a("p",{staticStyle:{margin:"0"}},[a("strong",[t._v("证据等级：")]),t._v(t._s(e.evidenceLevel)+"\n              ")]):t._e(),t._v(" "),e.provenance?a("p",{staticStyle:{margin:"4px 0 0 0",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},[a("strong",[t._v("来源：")]),t._v(t._s(e.provenance)+"\n              ")]):t._e()])])])],1)}),1)],1),t._v(" "),a("div",{staticClass:"modal-footer",staticStyle:{"text-align":"right","margin-top":"20px","padding-top":"16px","border-top":"1px solid #e8e8e8"}},[a("a-button",{on:{click:t.onCancel}},[t._v("取消")]),t._v(" "),a("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary",disabled:!t.selectedStandardId},on:{click:t.applySelectedStandardPrescription}},[t._v("\n      应用选中的标准处方\n    ")])],1)])},staticRenderFns:[]},v=a("VU/8")(p,u,!1,function(t){a("w/5g")},"data-v-65d39983",null);e.default=v.exports}});