webpackJsonp([66],{Jm97:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("Dd8w"),s=r.n(a),i=r("Xxa5"),n=r.n(i),o=r("exGp"),l=r.n(o),u=r("Mqi+"),d=r("jmyz"),c={name:"PrescriptionEdit",props:{prescriptionEditVisiable:{default:!1}},computed:{show:{get:function(){return this.prescriptionEditVisiable},set:function(){}}},data:function(){return{form:this.$form.createForm(this),loading:!1,rowId:null,selectedStandardPrescriptionName:"",stimulationSiteOptions:[],isTBSMode:!1}},mounted:function(){var e=this;return l()(n.a.mark(function t(){return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(u.b)(e);case 2:e.stimulationSiteOptions=t.sent,e.$nextTick(function(){e.setupFormWatchers()});case 4:case"end":return t.stop()}},t,e)}))()},methods:{setFormValues:function(e){this.rowId=e.id;var t={};["patientId","hospitalId","doctorId","presType","presStrength","presFreq","lastTime","pauseTime","repeatCount","periods","totalCount","totalTime","presPartId","presPartName","standardPresName","tbsType","innerFreq","innerCount","interFreq","interCount","status"].forEach(function(r){t[r]=e[r]}),this.form.setFieldsValue(t),this.isTBSMode=1===parseInt(e.presType),this.selectedStandardPrescriptionName=e.standardPresName||""},reset:function(){this.loading=!1,this.form.resetFields(),this.selectedStandardPrescriptionName="",this.formWatcher&&(clearInterval(this.formWatcher),this.formWatcher=null)},onClose:function(){this.reset(),this.$emit("close")},beforeDestroy:function(){this.formWatcher&&(clearInterval(this.formWatcher),this.formWatcher=null)},handleSubmit:function(){var e=this;this.form.validateFields(function(t,r){if(!t){var a=s()({},r,{id:e.rowId,presType:parseInt(r.presType),presStrength:parseFloat(r.presStrength),presFreq:parseFloat(r.presFreq),lastTime:parseFloat(r.lastTime),pauseTime:parseInt(r.pauseTime),repeatCount:parseInt(r.repeatCount),totalCount:parseInt(r.totalCount),totalTime:parseInt(r.totalTime),tbsType:null!==r.tbsType&&void 0!==r.tbsType?parseInt(r.tbsType):null,innerFreq:null!==r.innerFreq&&void 0!==r.innerFreq?parseFloat(r.innerFreq):null,innerCount:null!==r.innerCount&&void 0!==r.innerCount?parseInt(r.innerCount):null,interFreq:null!==r.interFreq&&void 0!==r.interFreq?parseFloat(r.interFreq):null,interCount:null!==r.interCount&&void 0!==r.interCount?parseInt(r.interCount):null,periods:null!==r.periods&&void 0!==r.periods?parseInt(r.periods):1,status:parseInt(r.status)}),i=e.stimulationSiteOptions.find(function(e){return e.value===a.presPartId});a.presPartName=i?i.label:"";var n=Object(d.d)(a,e.stimulationSiteOptions.map(function(e){return e.label}));if(!n.valid)return void e.$message.error(n.message);e.loading=!0,e.$putJson("/prescription",a).then(function(){e.reset(),e.$emit("success")}).catch(function(){e.loading=!1})}})},showStandardPrescriptionModal:function(){this.$emit("openStandardPrescriptionModal")},applyStandardPrescription:function(e){this.selectedStandardPrescriptionName=e.indication1+" - "+e.indication2;var t={presFreq:e.presFreq,lastTime:e.lastTime,pauseTime:e.pauseTime,repeatCount:e.repeatCount,totalTime:60*e.totalTime,presPartId:this.getSiteIdByName(e.presPart),presPartName:e.presPart,standardPresName:this.selectedStandardPrescriptionName};this.form.setFieldsValue(t),this.$message.success("标准处方参数已自动填充")},getSiteIdByName:function(e){var t=this.stimulationSiteOptions.find(function(t){return t.label===e});return t?t.value:null},setupFormWatchers:function(){var e=this;this.formWatcher=setInterval(function(){e.autoCalculateTotalCount()},500)},onPresTypeChange:function(e){var t=parseInt(e);if(this.isTBSMode=1===t,0===t)this.form.setFieldsValue({tbsType:null,innerFreq:null,innerCount:null,interFreq:null,interCount:null});else if(1===t){this.form.setFieldsValue({tbsType:0});var r=Object(d.c)(0);this.form.setFieldsValue(r)}this.autoCalculateTotalCount()},onTBSTypeChange:function(e){var t=Object(d.c)(parseInt(e));this.form.setFieldsValue(t),this.autoCalculateTotalCount()},autoCalculateTotalCount:function(){var e=this.form.getFieldsValue(),t=parseInt(e.presType);if(0===t){var r=Object(d.a)(parseFloat(e.presFreq)||0,parseFloat(e.lastTime)||0,parseInt(e.repeatCount)||0);r>0&&this.form.setFieldsValue({totalCount:r})}else if(1===t){var a=Object(d.b)(parseInt(e.innerCount)||0,parseInt(e.interCount)||0,parseInt(e.periods)||1);a>0&&this.form.setFieldsValue({totalCount:a})}}}},m={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("a-modal",{attrs:{title:"编辑处方",width:900},on:{cancel:e.onClose},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[r("template",{slot:"footer"},[r("a-button",{key:"back",on:{click:e.onClose}},[e._v("取消")]),e._v(" "),r("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.handleSubmit}},[e._v("修改")])],1),e._v(" "),r("a-form",{attrs:{form:e.form,layout:"vertical"}},[r("a-row",{attrs:{gutter:20}},[r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"患者ID"}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["patientId",{rules:[{required:!0,message:"请输入患者ID!"}]}],expression:"['patientId', { rules: [{ required: true, message: '请输入患者ID!' }] }]"}]})],1)],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"医院ID"}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["hospitalId",{rules:[{required:!0,message:"请输入医院ID!"}]}],expression:"['hospitalId', { rules: [{ required: true, message: '请输入医院ID!' }] }]"}]})],1)],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"医生ID"}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["doctorId",{rules:[{required:!0,message:"请输入医生ID!"}]}],expression:"['doctorId', { rules: [{ required: true, message: '请输入医生ID!' }] }]"}]})],1)],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"处方类型"}},[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["presType",{rules:[{required:!0,message:"请选择处方类型!"}]}],expression:"['presType', { rules: [{ required: true, message: '请选择处方类型!' }] }]"}],on:{change:e.onPresTypeChange}},[r("a-select-option",{attrs:{value:"0"}},[e._v("普通处方")]),e._v(" "),r("a-select-option",{attrs:{value:"1"}},[e._v("TBS处方")])],1)],1)],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"刺激强度(%)"}},[r("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["presStrength",{rules:[{required:!0,message:"请输入刺激强度!"}]}],expression:"['presStrength', { rules: [{ required: true, message: '请输入刺激强度!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:100}})],1)],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"刺激频率(Hz)"}},[r("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["presFreq",{rules:[{required:!0,message:"请输入刺激频率!"}]}],expression:"['presFreq', { rules: [{ required: true, message: '请输入刺激频率!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:50,step:.1}})],1)],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"刺激时间(秒)"}},[r("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["lastTime",{rules:[{required:!0,message:"请输入刺激时间!"}]}],expression:"['lastTime', { rules: [{ required: true, message: '请输入刺激时间!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:60,step:.1}})],1)],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"间歇时间(秒)"}},[r("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["pauseTime",{rules:[{required:!0,message:"请输入间歇时间!"}]}],expression:"['pauseTime', { rules: [{ required: true, message: '请输入间歇时间!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:300}})],1)],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"重复次数(次)"}},[r("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["repeatCount",{rules:[{required:!0,message:"请输入重复次数!"}]}],expression:"['repeatCount', { rules: [{ required: true, message: '请输入重复次数!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:1e3}})],1)],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"周期数(个)"}},[r("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["periods",{rules:[{required:!0,message:"请输入周期数!"}]}],expression:"['periods', { rules: [{ required: true, message: '请输入周期数!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:1,max:1e3}})],1)],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"总脉冲数(个)"}},[r("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["totalCount",{rules:[{required:!0,message:"请输入总脉冲数!"}]}],expression:"['totalCount', { rules: [{ required: true, message: '请输入总脉冲数!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:1e4}})],1)],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"总时间(秒)"}},[r("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["totalTime",{rules:[{required:!0,message:"请输入总时间!"}]}],expression:"['totalTime', { rules: [{ required: true, message: '请输入总时间!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:0,max:7200}})],1)],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"治疗部位"}},[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["presPartId",{rules:[{required:!0,message:"请选择治疗部位!"}]}],expression:"['presPartId', { rules: [{ required: true, message: '请选择治疗部位!' }] }]"}],attrs:{placeholder:"请选择治疗部位"}},e._l(e.stimulationSiteOptions,function(t){return r("a-select-option",{key:t.value,attrs:{value:t.value}},[e._v("\n            ["+e._s(t.category)+"] "+e._s(t.label)+"\n          ")])}),1)],1)],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"标准处方"}},[r("a-row",{attrs:{gutter:16}},[r("a-col",{attrs:{span:16}},[r("a-input",{staticStyle:{cursor:"pointer"},attrs:{placeholder:"点击选择标准处方",readonly:""},on:{click:e.showStandardPrescriptionModal},model:{value:e.selectedStandardPrescriptionName,callback:function(t){e.selectedStandardPrescriptionName=t},expression:"selectedStandardPrescriptionName"}})],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-button",{attrs:{type:"primary",icon:"search"},on:{click:e.showStandardPrescriptionModal}},[e._v("\n                选择\n              ")])],1)],1)],1)],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"TBS类型"}},[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["tbsType"],expression:"['tbsType']"}],attrs:{disabled:!e.isTBSMode},on:{change:e.onTBSTypeChange}},[r("a-select-option",{attrs:{value:"0"}},[e._v("iTBS")]),e._v(" "),r("a-select-option",{attrs:{value:"1"}},[e._v("cTBS")])],1)],1)],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"丛内频率(Hz)"}},[r("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["innerFreq"],expression:"['innerFreq']"}],staticStyle:{width:"100%"},attrs:{min:.1,max:200,step:.1,disabled:""}})],1)],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"丛内个数(个)"}},[r("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["innerCount"],expression:"['innerCount']"}],staticStyle:{width:"100%"},attrs:{min:1,max:200,disabled:""}})],1)],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"丛间频率(Hz)"}},[r("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["interFreq"],expression:"['interFreq']"}],staticStyle:{width:"100%"},attrs:{min:.1,max:200,step:.1,disabled:""}})],1)],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"丛间个数(个)"}},[r("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["interCount"],expression:"['interCount']"}],staticStyle:{width:"100%"},attrs:{min:1,max:200,disabled:""}})],1)],1),e._v(" "),r("a-col",{attrs:{span:8}},[r("a-form-item",{attrs:{label:"状态"}},[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["status"],expression:"['status']"}]},[r("a-select-option",{attrs:{value:"0"}},[e._v("草稿")]),e._v(" "),r("a-select-option",{attrs:{value:"1"}},[e._v("已下发")]),e._v(" "),r("a-select-option",{attrs:{value:"2"}},[e._v("执行中")]),e._v(" "),r("a-select-option",{attrs:{value:"3"}},[e._v("完成")]),e._v(" "),r("a-select-option",{attrs:{value:"4"}},[e._v("异常")])],1)],1)],1)],1)],1)],2)},staticRenderFns:[]},p=r("VU/8")(c,m,!1,function(e){r("Ubkq")},"data-v-54b7e0b3",null);t.default=p.exports},Ubkq:function(e,t){}});